<div class="border-t border-gray-200 p-4">
  <div class="flex items-center space-x-3">
    <%= form_with(model: Message.new, url: messages_path, method: :post, class: "flex-1") do |f| %>
      <%= f.hidden_field :chat_id, value: chat.id %>
      <%= f.hidden_field :sender, value: "user" %>
      <div class="flex gap-2">
        <%= f.text_field :content, 
            placeholder: (local_assigns[:loading] || !chat.thread_id.present?) ? "Please wait while the chat initializes..." : "Type your message...", 
            class: "flex-1 rounded-md bg-white px-3 py-2 text-sm text-stone-900 ring-1 ring-inset ring-stone-300 shadow-xs placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-black",
            disabled: local_assigns[:loading] || !chat.thread_id.present? %>
        <%= f.submit "Send", 
            class: "cursor-pointer rounded-md px-3 py-2 text-sm font-semibold text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 #{(!local_assigns[:loading] && chat.thread_id.present?) ? 'bg-black hover:bg-stone-900' : 'bg-gray-400 cursor-not-allowed'}", 
            disabled: local_assigns[:loading] || !chat.thread_id.present? %>
      </div>
    <% end %>
  </div>
</div>
