// @sentry-internal/browser-utils@9.17.0 downloaded from https://ga.jspm.io/npm:@sentry-internal/browser-utils@9.17.0/build/esm/index.js

import{GLOBAL_OBJ as t,logger as e,getFunctionName as n,spanToJSON as r,withActiveSpan as o,startInactiveSpan as i,getClient as s,getCurrentScope as c,getActiveSpan as a,getRootSpan as u,browserPerformanceTimeOrigin as l,htmlTreeAsString as d,SEMANTIC_ATTRIBUTE_EXCLUSIVE_TIME as f,SEMANTIC_ATTRIBUTE_SENTRY_OP as p,SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN as m,SEMANTIC_ATTRIBUTE_SENTRY_MEASUREMENT_VALUE as h,SEMANTIC_ATTRIBUTE_SENTRY_MEASUREMENT_UNIT as y,getComponentName as v,setMeasurement as g,parseUrl as b,addHandler as _,maybeInstrument as T,triggerHandlers as E,fill as k,addNonEnumerableProperty as S,uuid4 as w,supportsHistory as C,isNativeFunction as L,timestampInSeconds as A,isString as P}from"@sentry/core";const x=typeof __SENTRY_DEBUG__==="undefined"||__SENTRY_DEBUG__;const I=(t,e)=>t>e[1]?"poor":t>e[0]?"needs-improvement":"good";const R=(t,e,n,r)=>{let o;let i;return s=>{if(e.value>=0&&(s||r)){i=e.value-(o||0);if(i||o===void 0){o=e.value;e.delta=i;e.rating=I(e.value,n);t(e)}}}};const M=t;const N=()=>`v4-${Date.now()}-${Math.floor(Math.random()*8999999999999)+1e12}`;const O=(t=true)=>{const e=M.performance?.getEntriesByType?.("navigation")[0];if(!t||e&&e.responseStart>0&&e.responseStart<performance.now())return e};const q=()=>{const t=O();return t?.activationStart||0};const $=(t,e)=>{const n=O();let r="navigate";n&&(M.document?.prerendering||q()>0?r="prerender":M.document?.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-")));const o=[];return{name:t,value:typeof e==="undefined"?-1:e,rating:"good",delta:0,entries:o,id:N(),navigationType:r}};const D=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const r=new PerformanceObserver((t=>{Promise.resolve().then((()=>{e(t.getEntries())}))}));r.observe(Object.assign({type:t,buffered:true},n||{}));return r}}catch(t){}};const B=t=>{const e=e=>{e.type!=="pagehide"&&M.document?.visibilityState!=="hidden"||t(e)};if(M.document){addEventListener("visibilitychange",e,true);addEventListener("pagehide",e,true)}};const H=t=>{let e=false;return()=>{if(!e){t();e=true}}};let U=-1;const z=()=>M.document.visibilityState!=="hidden"||M.document.prerendering?Infinity:0;const F=t=>{if(M.document.visibilityState==="hidden"&&U>-1){U=t.type==="visibilitychange"?t.timeStamp:0;j()}};const Y=()=>{addEventListener("visibilitychange",F,true);addEventListener("prerenderingchange",F,true)};const j=()=>{removeEventListener("visibilitychange",F,true);removeEventListener("prerenderingchange",F,true)};const G=()=>{if(M.document&&U<0){U=z();Y()}return{get firstHiddenTime(){return U}}};const X=t=>{M.document?.prerendering?addEventListener("prerenderingchange",(()=>t()),true):t()};const W=[1800,3e3];const J=(t,e={})=>{X((()=>{const n=G();const r=$("FCP");let o;const i=t=>{t.forEach((t=>{if(t.name==="first-contentful-paint"){s.disconnect();if(t.startTime<n.firstHiddenTime){r.value=Math.max(t.startTime-q(),0);r.entries.push(t);o(true)}}}))};const s=D("paint",i);s&&(o=R(t,r,W,e.reportAllChanges))}))};const K=[.1,.25];const Q=(t,e={})=>{J(H((()=>{const n=$("CLS",0);let r;let o=0;let i=[];const s=t=>{t.forEach((t=>{if(!t.hadRecentInput){const e=i[0];const n=i[i.length-1];if(o&&e&&n&&t.startTime-n.startTime<1e3&&t.startTime-e.startTime<5e3){o+=t.value;i.push(t)}else{o=t.value;i=[t]}}}));if(o>n.value){n.value=o;n.entries=i;r()}};const c=D("layout-shift",s);if(c){r=R(t,n,K,e.reportAllChanges);B((()=>{s(c.takeRecords());r(true)}));setTimeout(r,0)}})))};const V=[100,300];const Z=(t,e={})=>{X((()=>{const n=G();const r=$("FID");let o;const i=t=>{if(t.startTime<n.firstHiddenTime){r.value=t.processingStart-t.startTime;r.entries.push(t);o(true)}};const s=t=>{t.forEach(i)};const c=D("first-input",s);o=R(t,r,V,e.reportAllChanges);c&&B(H((()=>{s(c.takeRecords());c.disconnect()})))}))};let tt=0;let et=Infinity;let nt=0;const rt=t=>{t.forEach((t=>{if(t.interactionId){et=Math.min(et,t.interactionId);nt=Math.max(nt,t.interactionId);tt=nt?(nt-et)/7+1:0}}))};let ot;const it=()=>ot?tt:performance.interactionCount||0;const st=()=>{"interactionCount"in performance||ot||(ot=D("event",rt,{type:"event",buffered:true,durationThreshold:0}))};const ct=[];const at=new Map;const ut=40;let lt=0;const dt=()=>it()-lt;const ft=()=>{const t=Math.min(ct.length-1,Math.floor(dt()/50));return ct[t]};const pt=10;const mt=[];const ht=t=>{mt.forEach((e=>e(t)));if(!(t.interactionId||t.entryType==="first-input"))return;const e=ct[ct.length-1];const n=at.get(t.interactionId);if(n||ct.length<pt||e&&t.duration>e.latency){if(n)if(t.duration>n.latency){n.entries=[t];n.latency=t.duration}else t.duration===n.latency&&t.startTime===n.entries[0]?.startTime&&n.entries.push(t);else{const e={id:t.interactionId,latency:t.duration,entries:[t]};at.set(e.id,e);ct.push(e)}ct.sort(((t,e)=>e.latency-t.latency));ct.length>pt&&ct.splice(pt).forEach((t=>at.delete(t.id)))}};const yt=t=>{const e=M.requestIdleCallback||M.setTimeout;let n=-1;t=H(t);if(M.document?.visibilityState==="hidden")t();else{n=e(t);B(t)}return n};const vt=[200,500];const gt=(t,e={})=>{"PerformanceEventTiming"in M&&"interactionId"in PerformanceEventTiming.prototype&&X((()=>{st();const n=$("INP");let r;const o=t=>{yt((()=>{t.forEach(ht);const e=ft();if(e&&e.latency!==n.value){n.value=e.latency;n.entries=e.entries;r()}}))};const i=D("event",o,{durationThreshold:e.durationThreshold!=null?e.durationThreshold:ut});r=R(t,n,vt,e.reportAllChanges);if(i){i.observe({type:"first-input",buffered:true});B((()=>{o(i.takeRecords());r(true)}))}}))};const bt=[2500,4e3];const _t={};const Tt=(t,e={})=>{X((()=>{const n=G();const r=$("LCP");let o;const i=t=>{e.reportAllChanges||(t=t.slice(-1));t.forEach((t=>{if(t.startTime<n.firstHiddenTime){r.value=Math.max(t.startTime-q(),0);r.entries=[t];o()}}))};const s=D("largest-contentful-paint",i);if(s){o=R(t,r,bt,e.reportAllChanges);const n=H((()=>{if(!_t[r.id]){i(s.takeRecords());s.disconnect();_t[r.id]=true;o(true)}}));["keydown","click"].forEach((t=>{M.document&&addEventListener(t,(()=>yt(n)),{once:true,capture:true})}));B(n)}}))};const Et=[800,1800];
/**
 * Runs in the next task after the page is done loading and/or prerendering.
 * @param callback
 */const kt=t=>{M.document?.prerendering?X((()=>kt(t))):M.document?.readyState!=="complete"?addEventListener("load",(()=>kt(t)),true):setTimeout(t,0)};const St=(t,e={})=>{const n=$("TTFB");const r=R(t,n,Et,e.reportAllChanges);kt((()=>{const t=O();if(t){n.value=Math.max(t.responseStart-q(),0);n.entries=[t];r(true)}}))};const wt={};const Ct={};let Lt;let At;let Pt;let xt;let It;function Rt(t,e=false){return Yt("cls",t,Bt,Lt,e)}function Mt(t,e=false){return Yt("lcp",t,Ut,Pt,e)}function Nt(t){return Yt("fid",t,Ht,At)}function Ot(t){return Yt("ttfb",t,zt,xt)}function qt(t){return Yt("inp",t,Ft,It)}function $t(t,e){Gt(t,e);if(!Ct[t]){jt(t);Ct[t]=true}return Xt(t,e)}function Dt(t,r){const o=wt[t];if(o?.length)for(const i of o)try{i(r)}catch(r){x&&e.error(`Error while triggering instrumentation handler.\nType: ${t}\nName: ${n(i)}\nError:`,r)}}function Bt(){return Q((t=>{Dt("cls",{metric:t});Lt=t}),{reportAllChanges:true})}function Ht(){return Z((t=>{Dt("fid",{metric:t});At=t}))}function Ut(){return Tt((t=>{Dt("lcp",{metric:t});Pt=t}),{reportAllChanges:true})}function zt(){return St((t=>{Dt("ttfb",{metric:t});xt=t}))}function Ft(){return gt((t=>{Dt("inp",{metric:t});It=t}))}function Yt(t,e,n,r,o=false){Gt(t,e);let i;if(!Ct[t]){i=n();Ct[t]=true}r&&e({metric:r});return Xt(t,e,o?i:void 0)}function jt(t){const e={};t==="event"&&(e.durationThreshold=0);D(t,(e=>{Dt(t,{entries:e})}),e)}function Gt(t,e){wt[t]=wt[t]||[];wt[t].push(e)}function Xt(t,e,n){return()=>{n&&n();const r=wt[t];if(!r)return;const o=r.indexOf(e);o!==-1&&r.splice(o,1)}}function Wt(t){return"duration"in t}function Jt(t){return typeof t==="number"&&isFinite(t)}function Kt(t,e,n,{...s}){const c=r(t).start_timestamp;c&&c>e&&typeof t.updateStartTime==="function"&&t.updateStartTime(e);return o(t,(()=>{const t=i({startTime:e,...s});t&&t.end(n);return t}))}
/**
 * Starts an inactive, standalone span used to send web vital values to Sentry.
 * DO NOT use this for arbitrary spans, as these spans require special handling
 * during ingestion to extract metrics.
 *
 * This function adds a bunch of attributes and data to the span that's shared
 * by all web vital standalone spans. However, you need to take care of adding
 * the actual web vital value as an event to the span. Also, you need to assign
 * a transaction name and some other values that are specific to the web vital.
 *
 * Ultimately, you also need to take care of ending the span to send it off.
 *
 * @param options
 *
 * @returns an inactive, standalone and NOT YET ended span
 */function Qt(t){const e=s();if(!e)return;const{name:n,transaction:r,attributes:o,startTime:a}=t;const{release:u,environment:l,sendDefaultPii:d}=e.getOptions();const f=e.getIntegrationByName("Replay");const p=f?.getReplayId();const m=c();const h=m.getUser();const y=h!==void 0?h.email||h.id||h.ip_address:void 0;let v;try{v=m.getScopeData().contexts.profile.profile_id}catch{}const g={release:u,environment:l,user:y||void 0,profile_id:v||void 0,replay_id:p||void 0,transaction:r,"user_agent.original":M.navigator?.userAgent,"client.address":d?"{{auto}}":void 0,...o};return i({name:n,attributes:g,startTime:a,experimental:{standalone:true}})}function Vt(){return M.addEventListener&&M.performance}
/**
 * Converts from milliseconds to seconds
 * @param time time in ms
 */function Zt(t){return t/1e3}
/**
 * Converts ALPN protocol ids to name and version.
 *
 * (https://www.iana.org/assignments/tls-extensiontype-values/tls-extensiontype-values.xhtml#alpn-protocol-ids)
 * @param nextHopProtocol PerformanceResourceTiming.nextHopProtocol
 */function te(t){let e="unknown";let n="unknown";let r="";for(const o of t){if(o==="/"){[e,n]=t.split("/");break}if(!isNaN(Number(o))){e=r==="h"?"http":r;n=t.split(r)[1];break}r+=o}r===t&&(e=r);return{name:e,version:n}}function ee(){let t=0;let e;let n;if(!re())return;let o=false;function i(){if(!o){o=true;n&&ne(t,e,n);c()}}const c=Rt((({metric:n})=>{const r=n.entries[n.entries.length-1];if(r){t=n.value;e=r}}),true);B((()=>{i()}));setTimeout((()=>{const t=s();if(!t)return;const e=t.on("startNavigationSpan",(()=>{i();e?.()}));const o=a();if(o){const t=u(o);const e=r(t);e.op==="pageload"&&(n=t.spanContext().spanId)}}),0)}function ne(t,n,r){x&&e.log(`Sending CLS span (${t})`);const o=Zt((l()||0)+(n?.startTime||0));const i=c().getScopeData().transactionName;const s=n?d(n.sources[0]?.node):"Layout shift";const a={[m]:"auto.http.browser.cls",[p]:"ui.webvital.cls",[f]:n?.duration||0,"sentry.pageload.span_id":r};const u=Qt({name:s,transaction:i,attributes:a,startTime:o});if(u){u.addEvent("cls",{[y]:"",[h]:t});u.end(o)}}function re(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return false}}const oe=2147483647;let ie=0;let se={};let ce;let ae;
/**
 * Start tracking web vitals.
 * The callback returned by this function can be used to stop tracking & ensure all measurements are final & captured.
 *
 * @returns A function that forces web vitals collection
 */function ue({recordClsStandaloneSpans:t}){const e=Vt();if(e&&l()){e.mark&&M.performance.mark("sentry-tracing-init");const n=he();const r=me();const o=ye();const i=t?ee():pe();return()=>{n();r();o();i?.()}}return()=>{}}function le(){$t("longtask",(({entries:t})=>{const e=a();if(!e)return;const{op:n,start_timestamp:o}=r(e);for(const r of t){const t=Zt(l()+r.startTime);const i=Zt(r.duration);n==="navigation"&&o&&t<o||Kt(e,t,t+i,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[m]:"auto.ui.browser.metrics"}})}}))}function de(){const t=new PerformanceObserver((t=>{const e=a();if(e)for(const n of t.getEntries()){if(!n.scripts[0])continue;const t=Zt(l()+n.startTime);const{start_timestamp:o,op:i}=r(e);if(i==="navigation"&&o&&t<o)continue;const s=Zt(n.duration);const c={[m]:"auto.ui.browser.metrics"};const a=n.scripts[0];const{invoker:u,invokerType:d,sourceURL:f,sourceFunctionName:p,sourceCharPosition:h}=a;c["browser.script.invoker"]=u;c["browser.script.invoker_type"]=d;f&&(c["code.filepath"]=f);p&&(c["code.function"]=p);h!==-1&&(c["browser.script.source_char_position"]=h);Kt(e,t,t+s,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:c})}}));t.observe({type:"long-animation-frame",buffered:true})}function fe(){$t("event",(({entries:t})=>{const e=a();if(e)for(const n of t)if(n.name==="click"){const t=Zt(l()+n.startTime);const r=Zt(n.duration);const o={name:d(n.target),op:`ui.interaction.${n.name}`,startTime:t,attributes:{[m]:"auto.ui.browser.metrics"}};const i=v(n.target);i&&(o.attributes["ui.component_name"]=i);Kt(e,t,t+r,o)}}))}function pe(){return Rt((({metric:t})=>{const e=t.entries[t.entries.length-1];if(e){se.cls={value:t.value,unit:""};ae=e}}),true)}function me(){return Mt((({metric:t})=>{const e=t.entries[t.entries.length-1];if(e){se.lcp={value:t.value,unit:"millisecond"};ce=e}}),true)}function he(){return Nt((({metric:t})=>{const e=t.entries[t.entries.length-1];if(!e)return;const n=Zt(l());const r=Zt(e.startTime);se.fid={value:t.value,unit:"millisecond"};se["mark.fid"]={value:n+r,unit:"second"}}))}function ye(){return Ot((({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(se.ttfb={value:t.value,unit:"millisecond"})}))}function ve(t,e){const n=Vt();const o=l();if(!n?.getEntries||!o)return;const i=Zt(o);const s=n.getEntries();const{op:c,start_timestamp:a}=r(t);s.slice(ie).forEach((e=>{const n=Zt(e.startTime);const r=Zt(Math.max(0,e.duration));if(!(c==="navigation"&&a&&i+n<a))switch(e.entryType){case"navigation":be(t,e,i);break;case"mark":case"paint":case"measure":{ge(t,e,n,r,i);const o=G();const s=e.startTime<o.firstHiddenTime;e.name==="first-paint"&&s&&(se.fp={value:e.startTime,unit:"millisecond"});e.name==="first-contentful-paint"&&s&&(se.fcp={value:e.startTime,unit:"millisecond"});break}case"resource":ke(t,e,e.name,n,r,i);break}}));ie=Math.max(s.length-1,0);Se(t);if(c==="pageload"){Le(se);const n=se["mark.fid"];if(n&&se.fid){Kt(t,n.value,n.value+Zt(se.fid.value),{name:"first input delay",op:"ui.action",attributes:{[m]:"auto.ui.browser.metrics"}});delete se["mark.fid"]}"fcp"in se&&e.recordClsOnPageloadSpan||delete se.cls;Object.entries(se).forEach((([t,e])=>{g(t,e.value,e.unit)}));t.setAttribute("performance.timeOrigin",i);t.setAttribute("performance.activationStart",q());we(t)}ce=void 0;ae=void 0;se={}}function ge(t,e,n,r,o){const i=O(false);const s=Zt(i?i.requestStart:0);const c=o+Math.max(n,s);const a=o+n;const u=a+r;const l={[m]:"auto.resource.browser.metrics"};if(c!==a){l["sentry.browser.measure_happened_before_request"]=true;l["sentry.browser.measure_start_time"]=c}c<=u&&Kt(t,c,u,{name:e.name,op:e.entryType,attributes:l})}function be(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach((r=>{_e(t,e,r,n)}));_e(t,e,"secureConnection",n,"TLS/SSL");_e(t,e,"fetch",n,"cache");_e(t,e,"domainLookup",n,"DNS");Ee(t,e,n)}function _e(t,e,n,r,o=n){const i=Te(n);const s=e[i];const c=e[`${n}Start`];c&&s&&Kt(t,r+Zt(c),r+Zt(s),{op:`browser.${o}`,name:e.name,attributes:{[m]:"auto.ui.browser.metrics",...n==="redirect"&&e.redirectCount!=null?{"http.redirect_count":e.redirectCount}:{}}})}function Te(t){return t==="secureConnection"?"connectEnd":t==="fetch"?"domainLookupStart":`${t}End`}function Ee(t,e,n){const r=n+Zt(e.requestStart);const o=n+Zt(e.responseEnd);const i=n+Zt(e.responseStart);if(e.responseEnd){Kt(t,r,o,{op:"browser.request",name:e.name,attributes:{[m]:"auto.ui.browser.metrics"}});Kt(t,i,o,{op:"browser.response",name:e.name,attributes:{[m]:"auto.ui.browser.metrics"}})}}function ke(t,e,n,r,o,i){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const s=b(n);const c={[m]:"auto.resource.browser.metrics"};Ce(c,e,"transferSize","http.response_transfer_size");Ce(c,e,"encodedBodySize","http.response_content_length");Ce(c,e,"decodedBodySize","http.decoded_response_content_length");const a=e.deliveryType;a!=null&&(c["http.response_delivery_type"]=a);const u=e.renderBlockingStatus;u&&(c["resource.render_blocking_status"]=u);s.protocol&&(c["url.scheme"]=s.protocol.split(":").pop());s.host&&(c["server.address"]=s.host);c["url.same_origin"]=n.includes(M.location.origin);const{name:l,version:d}=te(e.nextHopProtocol);c["network.protocol.name"]=l;c["network.protocol.version"]=d;const f=i+r;const p=f+o;Kt(t,f,p,{name:n.replace(M.location.origin,""),op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",attributes:c})}function Se(t){const e=M.navigator;if(!e)return;const n=e.connection;if(n){n.effectiveType&&t.setAttribute("effectiveConnectionType",n.effectiveType);n.type&&t.setAttribute("connectionType",n.type);Jt(n.rtt)&&(se["connection.rtt"]={value:n.rtt,unit:"millisecond"})}Jt(e.deviceMemory)&&t.setAttribute("deviceMemory",`${e.deviceMemory} GB`);Jt(e.hardwareConcurrency)&&t.setAttribute("hardwareConcurrency",String(e.hardwareConcurrency))}function we(t){if(ce){ce.element&&t.setAttribute("lcp.element",d(ce.element));ce.id&&t.setAttribute("lcp.id",ce.id);ce.url&&t.setAttribute("lcp.url",ce.url.trim().slice(0,200));ce.loadTime!=null&&t.setAttribute("lcp.loadTime",ce.loadTime);ce.renderTime!=null&&t.setAttribute("lcp.renderTime",ce.renderTime);t.setAttribute("lcp.size",ce.size)}ae?.sources&&ae.sources.forEach(((e,n)=>t.setAttribute(`cls.source.${n+1}`,d(e.node))))}function Ce(t,e,n,r){const o=e[n];o!=null&&o<oe&&(t[r]=o)}function Le(t){const e=O(false);if(!e)return;const{responseStart:n,requestStart:r}=e;r<=n&&(t["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}const Ae=1e3;let Pe;let xe;let Ie;function Re(t){const e="dom";_(e,t);T(e,Me)}function Me(){if(!M.document)return;const t=E.bind(null,"dom");const e=qe(t,true);M.document.addEventListener("click",e,false);M.document.addEventListener("keypress",e,false);["EventTarget","Node"].forEach((e=>{const n=M;const r=n[e]?.prototype;if(r?.hasOwnProperty?.("addEventListener")){k(r,"addEventListener",(function(e){return function(n,r,o){if(n==="click"||n=="keypress")try{const r=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{};const i=r[n]=r[n]||{refCount:0};if(!i.handler){const r=qe(t);i.handler=r;e.call(this,n,r,o)}i.refCount++}catch(t){}return e.call(this,n,r,o)}}));k(r,"removeEventListener",(function(t){return function(e,n,r){if(e==="click"||e=="keypress")try{const n=this.__sentry_instrumentation_handlers__||{};const o=n[e];if(o){o.refCount--;if(o.refCount<=0){t.call(this,e,o.handler,r);o.handler=void 0;delete n[e]}Object.keys(n).length===0&&delete this.__sentry_instrumentation_handlers__}}catch(t){}return t.call(this,e,n,r)}}))}}))}function Ne(t){if(t.type!==xe)return false;try{if(!t.target||t.target._sentryId!==Ie)return false}catch(t){}return true}
/**
 * Decide whether an event should be captured.
 * @param event event to be captured
 */function Oe(t,e){return t==="keypress"&&(!e?.tagName||e.tagName!=="INPUT"&&e.tagName!=="TEXTAREA"&&!e.isContentEditable)}function qe(t,e=false){return n=>{if(!n||n._sentryCaptured)return;const r=$e(n);if(Oe(n.type,r))return;S(n,"_sentryCaptured",true);r&&!r._sentryId&&S(r,"_sentryId",w());const o=n.type==="keypress"?"input":n.type;if(!Ne(n)){const i={event:n,name:o,global:e};t(i);xe=n.type;Ie=r?r._sentryId:void 0}clearTimeout(Pe);Pe=M.setTimeout((()=>{Ie=void 0;xe=void 0}),Ae)}}function $e(t){try{return t.target}catch(t){return null}}let De;function Be(t){const e="history";_(e,t);T(e,He)}function He(){M.addEventListener("popstate",(()=>{const t=M.location.href;const e=De;De=t;if(e===t)return;const n={from:e,to:t};E("history",n)}));if(C()){k(M.history,"pushState",t);k(M.history,"replaceState",t)}function t(t){return function(...e){const n=e.length>2?e[2]:void 0;if(n){const r=De;const o=String(n);De=o;if(r===o)return t.apply(this,e);const i={from:r,to:o};E("history",i)}return t.apply(this,e)}}}const Ue={};function ze(t){const n=Ue[t];if(n)return n;let r=M[t];if(L(r))return Ue[t]=r.bind(M);const o=M.document;if(o&&typeof o.createElement==="function")try{const e=o.createElement("iframe");e.hidden=true;o.head.appendChild(e);const n=e.contentWindow;n?.[t]&&(r=n[t]);o.head.removeChild(e)}catch(n){x&&e.warn(`Could not create sandbox iframe for ${t} check, bailing to window.${t}: `,n)}return r?Ue[t]=r.bind(M):r}function Fe(t){Ue[t]=void 0}function Ye(...t){return ze("fetch")(...t)}function je(...t){return ze("setTimeout")(...t)}const Ge="__sentry_xhr_v3__";function Xe(t){const e="xhr";_(e,t);T(e,We)}function We(){if(!M.XMLHttpRequest)return;const t=XMLHttpRequest.prototype;t.open=new Proxy(t.open,{apply(t,e,n){const r=new Error;const o=A()*1e3;const i=P(n[0])?n[0].toUpperCase():void 0;const s=Je(n[1]);if(!i||!s)return t.apply(e,n);e[Ge]={method:i,url:s,request_headers:{}};i==="POST"&&s.match(/sentry_key/)&&(e.__sentry_own_request__=true);const c=()=>{const t=e[Ge];if(t&&e.readyState===4){try{t.status_code=e.status}catch(t){}const n={endTimestamp:A()*1e3,startTimestamp:o,xhr:e,virtualError:r};E("xhr",n)}};"onreadystatechange"in e&&typeof e.onreadystatechange==="function"?e.onreadystatechange=new Proxy(e.onreadystatechange,{apply(t,e,n){c();return t.apply(e,n)}}):e.addEventListener("readystatechange",c);e.setRequestHeader=new Proxy(e.setRequestHeader,{apply(t,e,n){const[r,o]=n;const i=e[Ge];i&&P(r)&&P(o)&&(i.request_headers[r.toLowerCase()]=o);return t.apply(e,n)}});return t.apply(e,n)}});t.send=new Proxy(t.send,{apply(t,e,n){const r=e[Ge];if(!r)return t.apply(e,n);n[0]!==void 0&&(r.body=n[0]);const o={startTimestamp:A()*1e3,xhr:e};E("xhr",o);return t.apply(e,n)}})}
/**
 * Parses the URL argument of a XHR method to a string.
 *
 * See: https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/open#url
 * url: A string or any other object with a stringifier — including a URL object — that provides the URL of the resource to send the request to.
 *
 * @param url - The URL argument of an XHR method
 * @returns The parsed URL string or undefined if the URL is invalid
 */function Je(t){if(P(t))return t;try{return t.toString()}catch{}}function Ke(t){return new URLSearchParams(t).toString()}function Qe(t,n=e){try{if(typeof t==="string")return[t];if(t instanceof URLSearchParams)return[t.toString()];if(t instanceof FormData)return[Ke(t)];if(!t)return[void 0]}catch(e){x&&n.error(e,"Failed to serialize body",t);return[void 0,"BODY_PARSE_ERROR"]}x&&n.info("Skipping network body because of body type",t);return[void 0,"UNPARSEABLE_BODY_TYPE"]}function Ve(t=[]){if(t.length===2&&typeof t[1]==="object")return t[1].body}const Ze=[];const tn=new Map;function en(){const t=Vt();if(t&&l()){const t=rn();return()=>{t()}}return()=>{}}const nn={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function rn(){return qt((({metric:t})=>{if(t.value==void 0)return;const e=t.entries.find((e=>e.duration===t.value&&nn[e.name]));if(!e)return;const{interactionId:n}=e;const o=nn[e.name];const i=Zt(l()+e.startTime);const s=Zt(t.value);const v=a();const g=v?u(v):void 0;const b=n!=null?tn.get(n):void 0;const _=b||g;const T=_?r(_).description:c().getScopeData().transactionName;const E=d(e.target);const k={[m]:"auto.http.browser.inp",[p]:`ui.interaction.${o}`,[f]:e.duration};const S=Qt({name:E,transaction:T,attributes:k,startTime:i});if(S){S.addEvent("inp",{[y]:"millisecond",[h]:t.value});S.end(i+s)}}))}function on(){const t=({entries:t})=>{const e=a();const n=e&&u(e);t.forEach((t=>{if(!Wt(t)||!n)return;const e=t.interactionId;if(e!=null&&!tn.has(e)){if(Ze.length>10){const t=Ze.shift();tn.delete(t)}Ze.push(e);tn.set(e,n)}}))};$t("event",t);$t("first-input",t)}export{Ge as SENTRY_XHR_DATA_KEY,Re as addClickKeypressInstrumentationHandler,Rt as addClsInstrumentationHandler,Nt as addFidInstrumentationHandler,Be as addHistoryInstrumentationHandler,qt as addInpInstrumentationHandler,Mt as addLcpInstrumentationHandler,ve as addPerformanceEntries,$t as addPerformanceInstrumentationHandler,Ot as addTtfbInstrumentationHandler,Xe as addXhrInstrumentationHandler,Fe as clearCachedImplementation,te as extractNetworkProtocol,Ye as fetch,Qe as getBodyString,Ve as getFetchRequestArgBody,ze as getNativeImplementation,on as registerInpInteractionListener,Ke as serializeFormData,je as setTimeout,en as startTrackingINP,fe as startTrackingInteractions,de as startTrackingLongAnimationFrames,le as startTrackingLongTasks,ue as startTrackingWebVitals};

