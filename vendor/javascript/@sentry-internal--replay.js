// @sentry-internal/replay@9.17.0 downloaded from https://ga.jspm.io/npm:@sentry-internal/replay@9.17.0/build/npm/esm/index.js

import{GLOBAL_OBJ as e,normalize as t,fill as n,htmlTreeAsString as s,browserPerformanceTimeOrigin as r,addBreadcrumb as o,logger as i,severityLevelFromString as a,captureException as c,uuid4 as l,getClient as u,getLocationHref as d,getCurrentScope as h,getActiveSpan as p,getDynamicSamplingContextFromSpan as f,isSentryRequestUrl as m,stringMatchesSomePattern as y,addEventProcessor as g,createEnvelope as S,createEventEnvelopeHeaders as k,getSdkMetadataForEnvelopeHeader as v,prepareEvent as b,getIsolationScope as w,resolvedSyncPromise as _,updateRateLimits as I,isRateLimited as C,setContext as E,getRootSpan as M,spanToJSON as x,SEMANTIC_ATTRIBUTE_SENTRY_SOURCE as T,isBrowser as R,parseSampleRate as O,consoleSandbox as A}from"@sentry/core";import{setTimeout as D,addPerformanceInstrumentationHandler as N,addLcpInstrumentationHandler as L,addClsInstrumentationHandler as F,addFidInstrumentationHandler as P,addInpInstrumentationHandler as B,serializeFormData as z,getFetchRequestArgBody as U,getBodyString as W,SENTRY_XHR_DATA_KEY as H,addClickKeypressInstrumentationHandler as j,addHistoryInstrumentationHandler as $}from"@sentry-internal/browser-utils";const q=e;const V="sentryReplaySession";const K="replay_event";const J="Unable to send Replay";const G=3e5;const Y=9e5;const X=5e3;const Q=5500;const Z=6e4;const ee=5e3;const te=3;const ne=15e4;const se=5e3;const re=3e3;const oe=300;const ie=2e7;const ae=4999;const ce=15e3;const le=36e5;var ue=Object.defineProperty;var de=(e,t,n)=>t in e?ue(e,t,{enumerable:true,configurable:true,writable:true,value:n}):e[t]=n;var he=(e,t,n)=>de(e,typeof t!=="symbol"?t+"":t,n);var pe=(e=>{e[e.Document=0]="Document";e[e.DocumentType=1]="DocumentType";e[e.Element=2]="Element";e[e.Text=3]="Text";e[e.CDATA=4]="CDATA";e[e.Comment=5]="Comment";return e})(pe||{});function fe(e){return e.nodeType===e.ELEMENT_NODE}function me(e){const t=e?.host;return Boolean(t?.shadowRoot===e)}function ye(e){return Object.prototype.toString.call(e)==="[object ShadowRoot]"}function ge(e){e.includes(" background-clip: text;")&&!e.includes(" -webkit-background-clip: text;")&&(e=e.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;"));return e}function Se(e){const{cssText:t}=e;if(t.split('"').length<3)return t;const n=["@import",`url(${JSON.stringify(e.href)})`];e.layerName===""?n.push("layer"):e.layerName&&n.push(`layer(${e.layerName})`);e.supportsText&&n.push(`supports(${e.supportsText})`);e.media.length&&n.push(e.media.mediaText);return n.join(" ")+";"}function ke(e){try{const t=e.rules||e.cssRules;return t?ge(Array.from(t,be).join("")):null}catch(e){return null}}function ve(e){let t="";for(let n=0;n<e.style.length;n++){const s=e.style;const r=s[n];const o=s.getPropertyPriority(r);t+=`${r}:${s.getPropertyValue(r)}${o?" !important":""};`}return`${e.selectorText} { ${t} }`}function be(e){let t;if(_e(e))try{t=ke(e.styleSheet)||Se(e)}catch(e){}else if(Ie(e)){let t=e.cssText;const n=e.selectorText.includes(":");const s=typeof e.style.all==="string"&&e.style.all;s&&(t=ve(e));n&&(t=we(t));if(n||s)return t}return t||e.cssText}function we(e){const t=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return e.replace(t,"$1\\$2")}function _e(e){return"styleSheet"in e}function Ie(e){return"selectorText"in e}class Mirror{constructor(){he(this,"idNodeMap",new Map);he(this,"nodeMetaMap",new WeakMap)}getId(e){if(!e)return-1;const t=this.getMeta(e)?.id;return t??-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const t=this.getId(e);this.idNodeMap.delete(t);e.childNodes&&e.childNodes.forEach((e=>this.removeNodeFromMap(e)))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,t){const n=t.id;this.idNodeMap.set(n,e);this.nodeMetaMap.set(e,t)}replace(e,t){const n=this.getNode(e);if(n){const e=this.nodeMetaMap.get(n);e&&this.nodeMetaMap.set(t,e)}this.idNodeMap.set(e,t)}reset(){this.idNodeMap=new Map;this.nodeMetaMap=new WeakMap}}function Ce(){return new Mirror}function Ee({maskInputOptions:e,tagName:t,type:n}){t==="OPTION"&&(t="SELECT");return Boolean(e[t.toLowerCase()]||n&&e[n]||n==="password"||t==="INPUT"&&!n&&e.text)}function Me({isMasked:e,element:t,value:n,maskInputFn:s}){let r=n||"";if(!e)return r;s&&(r=s(r,t));return"*".repeat(r.length)}function xe(e){return e.toLowerCase()}function Te(e){return e.toUpperCase()}const Re="__rrweb_original__";function Oe(e){const t=e.getContext("2d");if(!t)return true;const n=50;for(let s=0;s<e.width;s+=n)for(let r=0;r<e.height;r+=n){const o=t.getImageData;const i=Re in o?o[Re]:o;const a=new Uint32Array(i.call(t,s,r,Math.min(n,e.width-s),Math.min(n,e.height-r)).data.buffer);if(a.some((e=>e!==0)))return false}return true}function Ae(e){const t=e.type;return e.hasAttribute("data-rr-is-password")?"password":t?xe(t):null}function De(e,t,n){return t!=="INPUT"||n!=="radio"&&n!=="checkbox"?e.value:e.getAttribute("value")||""}function Ne(e,t){let n;try{n=new URL(e,t??window.location.href)}catch(e){return null}const s=/\.([0-9a-z]+)(?:$)/i;const r=n.pathname.match(s);return r?.[1]??null}const Le={};function Fe(e){const t=Le[e];if(t)return t;const n=window.document;let s=window[e];if(n&&typeof n.createElement==="function")try{const t=n.createElement("iframe");t.hidden=true;n.head.appendChild(t);const r=t.contentWindow;r&&r[e]&&(s=r[e]);n.head.removeChild(t)}catch(e){}return Le[e]=s.bind(window)}function Pe(...e){return Fe("setTimeout")(...e)}function Be(...e){return Fe("clearTimeout")(...e)}function ze(e){try{return e.contentDocument}catch(e){}}let Ue=1;const We=new RegExp("[^a-z0-9-_:]");const He=-2;function je(){return Ue++}function $e(e){if(e instanceof HTMLFormElement)return"form";const t=xe(e.tagName);return We.test(t)?"div":t}function qe(e){let t="";t=e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0];t=t.split("?")[0];return t}let Ve;let Ke;const Je=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm;const Ge=/^(?:[a-z+]+:)?\/\//i;const Ye=/^www\..*/i;const Xe=/^(data:)([^,]*),(.*)/i;function Qe(e,t){return(e||"").replace(Je,((e,n,s,r,o,i)=>{const a=s||o||i;const c=n||r||"";if(!a)return e;if(Ge.test(a)||Ye.test(a))return`url(${c}${a}${c})`;if(Xe.test(a))return`url(${c}${a}${c})`;if(a[0]==="/")return`url(${c}${qe(t)+a}${c})`;const l=t.split("/");const u=a.split("/");l.pop();for(const e of u)e!=="."&&(e===".."?l.pop():l.push(e));return`url(${c}${l.join("/")}${c})`}))}const Ze=/^[^ \t\n\r\u000c]+/;const et=/^[, \t\n\r\u000c]+/;function tt(e,t){if(t.trim()==="")return t;let n=0;function s(e){let s;const r=e.exec(t.substring(n));if(r){s=r[0];n+=s.length;return s}return""}const r=[];while(true){s(et);if(n>=t.length)break;let o=s(Ze);if(o.slice(-1)===","){o=st(e,o.substring(0,o.length-1));r.push(o)}else{let s="";o=st(e,o);let i=false;while(true){const e=t.charAt(n);if(e===""){r.push((o+s).trim());break}if(i)e===")"&&(i=false);else{if(e===","){n+=1;r.push((o+s).trim());break}e==="("&&(i=true)}s+=e;n+=1}}}return r.join(", ")}const nt=new WeakMap;function st(e,t){return t&&t.trim()!==""?ot(e,t):t}function rt(e){return Boolean(e.tagName==="svg"||e.ownerSVGElement)}function ot(e,t){let n=nt.get(e);if(!n){n=e.createElement("a");nt.set(e,n)}if(t){if(t.startsWith("blob:")||t.startsWith("data:"))return t}else t="";n.setAttribute("href",t);return n.href}function it(e,t,n,s,r,o){return s?n==="src"||n==="href"&&(t!=="use"||s[0]!=="#")||n==="xlink:href"&&s[0]!=="#"?st(e,s):n!=="background"||t!=="table"&&t!=="td"&&t!=="th"?n==="srcset"?tt(e,s):n==="style"?Qe(s,ot(e)):t==="object"&&n==="data"?st(e,s):typeof o==="function"?o(n,s,r):s:st(e,s):s}function at(e,t,n){return(e==="video"||e==="audio")&&t==="autoplay"}function ct(e,t,n,s){try{if(s&&e.matches(s))return false;if(typeof t==="string"){if(e.classList.contains(t))return true}else for(let n=e.classList.length;n--;){const s=e.classList[n];if(t.test(s))return true}if(n)return e.matches(n)}catch(e){}return false}function lt(e,t){for(let n=e.classList.length;n--;){const s=e.classList[n];if(t.test(s))return true}return false}function ut(e,t,n=Infinity,s=0){return e?e.nodeType!==e.ELEMENT_NODE||s>n?-1:t(e)?s:ut(e.parentNode,t,n,s+1):-1}function dt(e,t){return n=>{const s=n;if(s===null)return false;try{if(e)if(typeof e==="string"){if(s.matches(`.${e}`))return true}else if(lt(s,e))return true;return!(!t||!s.matches(t))}catch{return false}}}function ht(e,t,n,s,r,o){try{const i=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(i===null)return false;if(i.tagName==="INPUT"){const e=i.getAttribute("autocomplete");const t=["current-password","new-password","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc"];if(t.includes(e))return true}let a=-1;let c=-1;if(o){c=ut(i,dt(s,r));if(c<0)return true;a=ut(i,dt(t,n),c>=0?c:Infinity)}else{a=ut(i,dt(t,n));if(a<0)return false;c=ut(i,dt(s,r),a>=0?a:Infinity)}return a>=0?!(c>=0)||a<=c:!(c>=0)&&!!o}catch(e){}return!!o}function pt(e,t,n){const s=e.contentWindow;if(!s)return;let r=false;let o;try{o=s.document.readyState}catch(e){return}if(o!=="complete"){const s=Pe((()=>{if(!r){t();r=true}}),n);e.addEventListener("load",(()=>{Be(s);r=true;t()}));return}const i="about:blank";if(s.location.href!==i||e.src===i||e.src===""){Pe(t,0);return e.addEventListener("load",t)}e.addEventListener("load",t)}function ft(e,t,n){let s=false;let r;try{r=e.sheet}catch(e){return}if(r)return;const o=Pe((()=>{if(!s){t();s=true}}),n);e.addEventListener("load",(()=>{Be(o);s=true;t()}))}function mt(e,t){const{doc:n,mirror:s,blockClass:r,blockSelector:o,unblockSelector:i,maskAllText:a,maskAttributeFn:c,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:h,inlineStylesheet:p,maskInputOptions:f={},maskTextFn:m,maskInputFn:y,dataURLOptions:g={},inlineImages:S,recordCanvas:k,keepIframeSrcFn:v,newlyAddedElement:b=false}=t;const w=yt(n,s);switch(e.nodeType){case e.DOCUMENT_NODE:return e.compatMode!=="CSS1Compat"?{type:pe.Document,childNodes:[],compatMode:e.compatMode}:{type:pe.Document,childNodes:[]};case e.DOCUMENT_TYPE_NODE:return{type:pe.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:w};case e.ELEMENT_NODE:return St(e,{doc:n,blockClass:r,blockSelector:o,unblockSelector:i,inlineStylesheet:p,maskAttributeFn:c,maskInputOptions:f,maskInputFn:y,dataURLOptions:g,inlineImages:S,recordCanvas:k,keepIframeSrcFn:v,newlyAddedElement:b,rootId:w,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:h});case e.TEXT_NODE:return gt(e,{doc:n,maskAllText:a,maskTextClass:l,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:h,maskTextFn:m,maskInputOptions:f,maskInputFn:y,rootId:w});case e.CDATA_SECTION_NODE:return{type:pe.CDATA,textContent:"",rootId:w};case e.COMMENT_NODE:return{type:pe.Comment,textContent:e.textContent||"",rootId:w};default:return false}}function yt(e,t){if(!t.hasNode(e))return;const n=t.getId(e);return n===1?void 0:n}function gt(e,t){const{maskAllText:n,maskTextClass:s,unmaskTextClass:r,maskTextSelector:o,unmaskTextSelector:i,maskTextFn:a,maskInputOptions:c,maskInputFn:l,rootId:u}=t;const d=e.parentNode&&e.parentNode.tagName;let h=e.textContent;const p=d==="STYLE"||void 0;const f=d==="SCRIPT"||void 0;const m=d==="TEXTAREA"||void 0;if(p&&h){try{e.nextSibling||e.previousSibling||e.parentNode.sheet?.cssRules&&(h=ke(e.parentNode.sheet))}catch(t){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${t}`,e)}h=Qe(h,ot(t.doc))}f&&(h="SCRIPT_PLACEHOLDER");const y=ht(e,s,o,r,i,n);p||f||m||!h||!y||(h=a?a(h,e.parentElement):h.replace(/[\S]/g,"*"));m&&h&&(c.textarea||y)&&(h=l?l(h,e.parentNode):h.replace(/[\S]/g,"*"));if(d==="OPTION"&&h){const t=Ee({type:null,tagName:d,maskInputOptions:c});h=Me({isMasked:ht(e,s,o,r,i,t),element:e,value:h,maskInputFn:l})}return{type:pe.Text,textContent:h||"",isStyle:p,rootId:u}}function St(e,t){const{doc:n,blockClass:s,blockSelector:r,unblockSelector:o,inlineStylesheet:i,maskInputOptions:a={},maskAttributeFn:c,maskInputFn:l,dataURLOptions:u={},inlineImages:d,recordCanvas:h,keepIframeSrcFn:p,newlyAddedElement:f=false,rootId:m,maskTextClass:y,unmaskTextClass:g,maskTextSelector:S,unmaskTextSelector:k}=t;const v=ct(e,s,r,o);const b=$e(e);let w={};const _=e.attributes.length;for(let t=0;t<_;t++){const s=e.attributes[t];s.name&&!at(b,s.name,s.value)&&(w[s.name]=it(n,b,xe(s.name),s.value,e,c))}if(b==="link"&&i){const t=Array.from(n.styleSheets).find((t=>t.href===e.href));let s=null;t&&(s=ke(t));if(s){w.rel=null;w.href=null;w.crossorigin=null;w._cssText=Qe(s,t.href)}}if(b==="style"&&e.sheet&&!(e.innerText||e.textContent||"").trim().length){const t=ke(e.sheet);t&&(w._cssText=Qe(t,ot(n)))}if(b==="input"||b==="textarea"||b==="select"||b==="option"){const t=e;const n=Ae(t);const s=De(t,Te(b),n);const r=t.checked;if(n!=="submit"&&n!=="button"&&s){const e=ht(t,y,S,g,k,Ee({type:n,tagName:Te(b),maskInputOptions:a}));w.value=Me({isMasked:e,element:t,value:s,maskInputFn:l})}r&&(w.checked=r)}b==="option"&&(e.selected&&!a.select?w.selected=true:delete w.selected);if(b==="canvas"&&h)if(e.__context==="2d")Oe(e)||(w.rr_dataURL=e.toDataURL(u.type,u.quality));else if(!("__context"in e)){const t=e.toDataURL(u.type,u.quality);const s=n.createElement("canvas");s.width=e.width;s.height=e.height;const r=s.toDataURL(u.type,u.quality);t!==r&&(w.rr_dataURL=t)}if(b==="img"&&d){if(!Ve){Ve=n.createElement("canvas");Ke=Ve.getContext("2d")}const t=e;const s=t.currentSrc||t.getAttribute("src")||"<unknown-src>";const r=t.crossOrigin;const o=()=>{t.removeEventListener("load",o);try{Ve.width=t.naturalWidth;Ve.height=t.naturalHeight;Ke.drawImage(t,0,0);w.rr_dataURL=Ve.toDataURL(u.type,u.quality)}catch(e){if(t.crossOrigin!=="anonymous"){t.crossOrigin="anonymous";t.complete&&t.naturalWidth!==0?o():t.addEventListener("load",o);return}console.warn(`Cannot inline img src=${s}! Error: ${e}`)}t.crossOrigin==="anonymous"&&(r?w.crossOrigin=r:t.removeAttribute("crossorigin"))};t.complete&&t.naturalWidth!==0?o():t.addEventListener("load",o)}if(b==="audio"||b==="video"){w.rr_mediaState=e.paused?"paused":"played";w.rr_mediaCurrentTime=e.currentTime}if(!f){e.scrollLeft&&(w.rr_scrollLeft=e.scrollLeft);e.scrollTop&&(w.rr_scrollTop=e.scrollTop)}if(v){const{width:t,height:n}=e.getBoundingClientRect();w={class:w.class,rr_width:`${t}px`,rr_height:`${n}px`}}if(b==="iframe"&&!p(w.src)){v||ze(e)||(w.rr_src=w.src);delete w.src}let I;try{customElements.get(b)&&(I=true)}catch(e){}return{type:pe.Element,tagName:b,attributes:w,childNodes:[],isSVG:rt(e)||void 0,needBlock:v,rootId:m,isCustom:I}}function kt(e){return e===void 0||e===null?"":e.toLowerCase()}function vt(e,t){if(t.comment&&e.type===pe.Comment)return true;if(e.type===pe.Element){if(t.script&&(e.tagName==="script"||e.tagName==="link"&&(e.attributes.rel==="preload"||e.attributes.rel==="modulepreload")||e.tagName==="link"&&e.attributes.rel==="prefetch"&&typeof e.attributes.href==="string"&&Ne(e.attributes.href)==="js"))return true;if(t.headFavicon&&(e.tagName==="link"&&e.attributes.rel==="shortcut icon"||e.tagName==="meta"&&(kt(e.attributes.name).match(/^msapplication-tile(image|color)$/)||kt(e.attributes.name)==="application-name"||kt(e.attributes.rel)==="icon"||kt(e.attributes.rel)==="apple-touch-icon"||kt(e.attributes.rel)==="shortcut icon")))return true;if(e.tagName==="meta"){if(t.headMetaDescKeywords&&kt(e.attributes.name).match(/^description|keywords$/))return true;if(t.headMetaSocial&&(kt(e.attributes.property).match(/^(og|twitter|fb):/)||kt(e.attributes.name).match(/^(og|twitter):/)||kt(e.attributes.name)==="pinterest"))return true;if(t.headMetaRobots&&(kt(e.attributes.name)==="robots"||kt(e.attributes.name)==="googlebot"||kt(e.attributes.name)==="bingbot"))return true;if(t.headMetaHttpEquiv&&e.attributes["http-equiv"]!==void 0)return true;if(t.headMetaAuthorship&&(kt(e.attributes.name)==="author"||kt(e.attributes.name)==="generator"||kt(e.attributes.name)==="framework"||kt(e.attributes.name)==="publisher"||kt(e.attributes.name)==="progid"||kt(e.attributes.property).match(/^article:/)||kt(e.attributes.property).match(/^product:/)))return true;if(t.headMetaVerification&&(kt(e.attributes.name)==="google-site-verification"||kt(e.attributes.name)==="yandex-verification"||kt(e.attributes.name)==="csrf-token"||kt(e.attributes.name)==="p:domain_verify"||kt(e.attributes.name)==="verify-v1"||kt(e.attributes.name)==="verification"||kt(e.attributes.name)==="shopify-checkout-api-token"))return true}}return false}function bt(e,t){const{doc:n,mirror:s,blockClass:r,blockSelector:o,unblockSelector:i,maskAllText:a,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:h=false,inlineStylesheet:p=true,maskInputOptions:f={},maskAttributeFn:m,maskTextFn:y,maskInputFn:g,slimDOMOptions:S,dataURLOptions:k={},inlineImages:v=false,recordCanvas:b=false,onSerialize:w,onIframeLoad:_,iframeLoadTimeout:I=5e3,onStylesheetLoad:C,stylesheetLoadTimeout:E=5e3,keepIframeSrcFn:M=()=>false,newlyAddedElement:x=false}=t;let{preserveWhiteSpace:T=true}=t;const R=mt(e,{doc:n,mirror:s,blockClass:r,blockSelector:o,maskAllText:a,unblockSelector:i,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,inlineStylesheet:p,maskInputOptions:f,maskAttributeFn:m,maskTextFn:y,maskInputFn:g,dataURLOptions:k,inlineImages:v,recordCanvas:b,keepIframeSrcFn:M,newlyAddedElement:x});if(!R){console.warn(e,"not serialized");return null}let O;O=s.hasNode(e)?s.getId(e):vt(R,S)||!T&&R.type===pe.Text&&!R.isStyle&&!R.textContent.replace(/^\s+|\s+$/gm,"").length?He:je();const A=Object.assign(R,{id:O});s.add(e,A);if(O===He)return null;w&&w(e);let D=!h;if(A.type===pe.Element){D=D&&!A.needBlock;delete A.needBlock;const t=e.shadowRoot;t&&ye(t)&&(A.isShadowHost=true)}if((A.type===pe.Document||A.type===pe.Element)&&D){S.headWhitespace&&A.type===pe.Element&&A.tagName==="head"&&(T=false);const t={doc:n,mirror:s,blockClass:r,blockSelector:o,maskAllText:a,unblockSelector:i,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:h,inlineStylesheet:p,maskInputOptions:f,maskAttributeFn:m,maskTextFn:y,maskInputFn:g,slimDOMOptions:S,dataURLOptions:k,inlineImages:v,recordCanvas:b,preserveWhiteSpace:T,onSerialize:w,onIframeLoad:_,iframeLoadTimeout:I,onStylesheetLoad:C,stylesheetLoadTimeout:E,keepIframeSrcFn:M};for(const n of Array.from(e.childNodes)){const e=bt(n,t);e&&A.childNodes.push(e)}if(fe(e)&&e.shadowRoot)for(const n of Array.from(e.shadowRoot.childNodes)){const s=bt(n,t);if(s){ye(e.shadowRoot)&&(s.isShadow=true);A.childNodes.push(s)}}}e.parentNode&&me(e.parentNode)&&ye(e.parentNode)&&(A.isShadow=true);A.type!==pe.Element||A.tagName!=="iframe"||ct(e,r,o,i)||pt(e,(()=>{const t=ze(e);if(t&&_){const n=bt(t,{doc:t,mirror:s,blockClass:r,blockSelector:o,unblockSelector:i,maskAllText:a,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:false,inlineStylesheet:p,maskInputOptions:f,maskAttributeFn:m,maskTextFn:y,maskInputFn:g,slimDOMOptions:S,dataURLOptions:k,inlineImages:v,recordCanvas:b,preserveWhiteSpace:T,onSerialize:w,onIframeLoad:_,iframeLoadTimeout:I,onStylesheetLoad:C,stylesheetLoadTimeout:E,keepIframeSrcFn:M});n&&_(e,n)}}),I);A.type===pe.Element&&A.tagName==="link"&&typeof A.attributes.rel==="string"&&(A.attributes.rel==="stylesheet"||A.attributes.rel==="preload"&&typeof A.attributes.href==="string"&&Ne(A.attributes.href)==="css")&&ft(e,(()=>{if(C){const t=bt(e,{doc:n,mirror:s,blockClass:r,blockSelector:o,unblockSelector:i,maskAllText:a,maskTextClass:c,unmaskTextClass:l,maskTextSelector:u,unmaskTextSelector:d,skipChild:false,inlineStylesheet:p,maskInputOptions:f,maskAttributeFn:m,maskTextFn:y,maskInputFn:g,slimDOMOptions:S,dataURLOptions:k,inlineImages:v,recordCanvas:b,preserveWhiteSpace:T,onSerialize:w,onIframeLoad:_,iframeLoadTimeout:I,onStylesheetLoad:C,stylesheetLoadTimeout:E,keepIframeSrcFn:M});t&&C(e,t)}}),E);return A}function wt(e,t){const{mirror:n=new Mirror,blockClass:s="rr-block",blockSelector:r=null,unblockSelector:o=null,maskAllText:i=false,maskTextClass:a="rr-mask",unmaskTextClass:c=null,maskTextSelector:l=null,unmaskTextSelector:u=null,inlineStylesheet:d=true,inlineImages:h=false,recordCanvas:p=false,maskAllInputs:f=false,maskAttributeFn:m,maskTextFn:y,maskInputFn:g,slimDOM:S=false,dataURLOptions:k,preserveWhiteSpace:v,onSerialize:b,onIframeLoad:w,iframeLoadTimeout:_,onStylesheetLoad:I,stylesheetLoadTimeout:C,keepIframeSrcFn:E=()=>false}=t||{};const M=f===true?{color:true,date:true,"datetime-local":true,email:true,month:true,number:true,range:true,search:true,tel:true,text:true,time:true,url:true,week:true,textarea:true,select:true}:f===false?{}:f;const x=S===true||S==="all"?{script:true,comment:true,headFavicon:true,headWhitespace:true,headMetaDescKeywords:S==="all",headMetaSocial:true,headMetaRobots:true,headMetaHttpEquiv:true,headMetaAuthorship:true,headMetaVerification:true}:S===false?{}:S;return bt(e,{doc:e,mirror:n,blockClass:s,blockSelector:r,unblockSelector:o,maskAllText:i,maskTextClass:a,unmaskTextClass:c,maskTextSelector:l,unmaskTextSelector:u,skipChild:false,inlineStylesheet:d,maskInputOptions:M,maskAttributeFn:m,maskTextFn:y,maskInputFn:g,slimDOMOptions:x,dataURLOptions:k,inlineImages:h,recordCanvas:p,preserveWhiteSpace:v,onSerialize:b,onIframeLoad:w,iframeLoadTimeout:_,onStylesheetLoad:I,stylesheetLoadTimeout:C,keepIframeSrcFn:E,newlyAddedElement:false})}function _t(e,t,n=document){const s={capture:true,passive:true};n.addEventListener(e,t,s);return()=>n.removeEventListener(e,t,s)}const It="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let Ct={map:{},getId(){console.error(It);return-1},getNode(){console.error(It);return null},removeNodeFromMap(){console.error(It)},has(){console.error(It);return false},reset(){console.error(It)}};typeof window!=="undefined"&&window.Proxy&&window.Reflect&&(Ct=new Proxy(Ct,{get(e,t,n){t==="map"&&console.error(It);return Reflect.get(e,t,n)}}));function Et(e,t,n={}){let s=null;let r=0;return function(...o){const i=Date.now();r||n.leading!==false||(r=i);const a=t-(i-r);const c=this;if(a<=0||a>t){if(s){Xt(s);s=null}r=i;e.apply(c,o)}else s||n.trailing===false||(s=Yt((()=>{r=n.leading===false?0:Date.now();s=null;e.apply(c,o)}),a))}}function Mt(e,t,n,s,r=window){const o=r.Object.getOwnPropertyDescriptor(e,t);r.Object.defineProperty(e,t,s?n:{set(e){Yt((()=>{n.set.call(this,e)}),0);o&&o.set&&o.set.call(this,e)}});return()=>Mt(e,t,o||{},true)}function xt(e,t,n){try{if(!(t in e))return()=>{};const s=e[t];const r=n(s);if(typeof r==="function"){r.prototype=r.prototype||{};Object.defineProperties(r,{__rrweb_original__:{enumerable:false,value:s}})}e[t]=r;return()=>{e[t]=s}}catch{return()=>{}}}let Tt=Date.now;/[1-9][0-9]{12}/.test(Date.now().toString())||(Tt=()=>(new Date).getTime());function Rt(e){const t=e.document;return{left:t.scrollingElement?t.scrollingElement.scrollLeft:e.pageXOffset!==void 0?e.pageXOffset:t?.documentElement.scrollLeft||t?.body?.parentElement?.scrollLeft||t?.body?.scrollLeft||0,top:t.scrollingElement?t.scrollingElement.scrollTop:e.pageYOffset!==void 0?e.pageYOffset:t?.documentElement.scrollTop||t?.body?.parentElement?.scrollTop||t?.body?.scrollTop||0}}function Ot(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function At(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function Dt(e){if(!e)return null;try{const t=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;return t}catch(e){return null}}function Nt(e,t,n,s,r){if(!e)return false;const o=Dt(e);if(!o)return false;const i=dt(t,n);if(!r){const e=s&&o.matches(s);return i(o)&&!e}const a=ut(o,i);let c=-1;if(a<0)return false;s&&(c=ut(o,dt(null,s)));return a>-1&&c<0||a<c}function Lt(e,t){return t.getId(e)!==-1}function Ft(e,t){return t.getId(e)===He}function Pt(e,t){if(me(e))return false;const n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||Pt(e.parentNode,t))}function Bt(e){return Boolean(e.changedTouches)}function zt(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach);"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach);Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do{if(this===t)return true}while(t=t&&t.parentNode);return false})}function Ut(e,t){return Boolean(e.nodeName==="IFRAME"&&t.getMeta(e))}function Wt(e,t){return Boolean(e.nodeName==="LINK"&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&e.getAttribute("rel")==="stylesheet"&&t.getMeta(e))}function Ht(e){return Boolean(e?.shadowRoot)}class StyleSheetMirror{constructor(){this.id=1;this.styleIDMap=new WeakMap;this.idStyleMap=new Map}getId(e){return this.styleIDMap.get(e)??-1}has(e){return this.styleIDMap.has(e)}
/**
   * @returns If the stylesheet is in the mirror, returns the id of the stylesheet. If not, return the new assigned id.
   */add(e,t){if(this.has(e))return this.getId(e);let n;n=t===void 0?this.id++:t;this.styleIDMap.set(e,n);this.idStyleMap.set(n,e);return n}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap;this.idStyleMap=new Map;this.id=1}generateId(){return this.id++}}function jt(e){let t=null;e.getRootNode?.()?.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&e.getRootNode().host&&(t=e.getRootNode().host);return t}function $t(e){let t=e;let n;while(n=jt(t))t=n;return t}function qt(e){const t=e.ownerDocument;if(!t)return false;const n=$t(e);return t.contains(n)}function Vt(e){const t=e.ownerDocument;return!!t&&(t.contains(e)||qt(e))}const Kt={};function Jt(e){const t=Kt[e];if(t)return t;const n=window.document;let s=window[e];if(n&&typeof n.createElement==="function")try{const t=n.createElement("iframe");t.hidden=true;n.head.appendChild(t);const r=t.contentWindow;r&&r[e]&&(s=r[e]);n.head.removeChild(t)}catch(e){}return Kt[e]=s.bind(window)}function Gt(...e){return Jt("requestAnimationFrame")(...e)}function Yt(...e){return Jt("setTimeout")(...e)}function Xt(...e){return Jt("clearTimeout")(...e)}var Qt=(e=>{e[e.DomContentLoaded=0]="DomContentLoaded";e[e.Load=1]="Load";e[e.FullSnapshot=2]="FullSnapshot";e[e.IncrementalSnapshot=3]="IncrementalSnapshot";e[e.Meta=4]="Meta";e[e.Custom=5]="Custom";e[e.Plugin=6]="Plugin";return e})(Qt||{});var Zt=(e=>{e[e.Mutation=0]="Mutation";e[e.MouseMove=1]="MouseMove";e[e.MouseInteraction=2]="MouseInteraction";e[e.Scroll=3]="Scroll";e[e.ViewportResize=4]="ViewportResize";e[e.Input=5]="Input";e[e.TouchMove=6]="TouchMove";e[e.MediaInteraction=7]="MediaInteraction";e[e.StyleSheetRule=8]="StyleSheetRule";e[e.CanvasMutation=9]="CanvasMutation";e[e.Font=10]="Font";e[e.Log=11]="Log";e[e.Drag=12]="Drag";e[e.StyleDeclaration=13]="StyleDeclaration";e[e.Selection=14]="Selection";e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet";e[e.CustomElement=16]="CustomElement";return e})(Zt||{});var en=(e=>{e[e.MouseUp=0]="MouseUp";e[e.MouseDown=1]="MouseDown";e[e.Click=2]="Click";e[e.ContextMenu=3]="ContextMenu";e[e.DblClick=4]="DblClick";e[e.Focus=5]="Focus";e[e.Blur=6]="Blur";e[e.TouchStart=7]="TouchStart";e[e.TouchMove_Departed=8]="TouchMove_Departed";e[e.TouchEnd=9]="TouchEnd";e[e.TouchCancel=10]="TouchCancel";return e})(en||{});var tn=(e=>{e[e.Mouse=0]="Mouse";e[e.Pen=1]="Pen";e[e.Touch=2]="Touch";return e})(tn||{});var nn=(e=>{e[e.Play=0]="Play";e[e.Pause=1]="Pause";e[e.Seeked=2]="Seeked";e[e.VolumeChange=3]="VolumeChange";e[e.RateChange=4]="RateChange";return e})(nn||{});function sn(e){try{return e.contentDocument}catch(e){}}function rn(e){try{return e.contentWindow}catch(e){}}function on(e){return"__ln"in e}class DoubleLinkedList{constructor(){this.length=0;this.head=null;this.tail=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let n=0;n<e;n++)t=t?.next||null;return t}addNode(e){const t={value:e,previous:null,next:null};e.__ln=t;if(e.previousSibling&&on(e.previousSibling)){const n=e.previousSibling.__ln.next;t.next=n;t.previous=e.previousSibling.__ln;e.previousSibling.__ln.next=t;n&&(n.previous=t)}else if(e.nextSibling&&on(e.nextSibling)&&e.nextSibling.__ln.previous){const n=e.nextSibling.__ln.previous;t.previous=n;t.next=e.nextSibling.__ln;e.nextSibling.__ln.previous=t;n&&(n.next=t)}else{this.head&&(this.head.previous=t);t.next=this.head;this.head=t}t.next===null&&(this.tail=t);this.length++}removeNode(e){const t=e.__ln;if(this.head){if(t.previous){t.previous.next=t.next;t.next?t.next.previous=t.previous:this.tail=t.previous}else{this.head=t.next;this.head?this.head.previous=null:this.tail=null}e.__ln&&delete e.__ln;this.length--}}}const an=(e,t)=>`${e}@${t}`;class MutationBuffer{constructor(){this.frozen=false;this.locked=false;this.texts=[];this.attributes=[];this.attributeMap=new WeakMap;this.removes=[];this.mapRemoves=[];this.movedMap={};this.addedSet=new Set;this.movedSet=new Set;this.droppedSet=new Set;this.processMutations=e=>{e.forEach(this.processMutation);this.emit()};this.emit=()=>{if(this.frozen||this.locked)return;const e=[];const t=new Set;const n=new DoubleLinkedList;const s=e=>{let t=e;let n=He;while(n===He){t=t&&t.nextSibling;n=t&&this.mirror.getId(t)}return n};const r=r=>{if(!r.parentNode||!Vt(r))return;const o=me(r.parentNode)?this.mirror.getId(jt(r)):this.mirror.getId(r.parentNode);const i=s(r);if(o===-1||i===-1)return n.addNode(r);const a=bt(r,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:true,newlyAddedElement:true,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:e=>{Ut(e,this.mirror)&&!Nt(e,this.blockClass,this.blockSelector,this.unblockSelector,false)&&this.iframeManager.addIframe(e);Wt(e,this.mirror)&&this.stylesheetManager.trackLinkElement(e);Ht(r)&&this.shadowDomManager.addShadowRoot(r.shadowRoot,this.doc)},onIframeLoad:(e,t)=>{if(!Nt(e,this.blockClass,this.blockSelector,this.unblockSelector,false)){this.iframeManager.attachIframe(e,t);e.contentWindow&&this.canvasManager.addWindow(e.contentWindow);this.shadowDomManager.observeAttachShadow(e)}},onStylesheetLoad:(e,t)=>{this.stylesheetManager.attachLinkElement(e,t)}});if(a){e.push({parentId:o,nextId:i,node:a});t.add(a.id)}};while(this.mapRemoves.length)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const e of this.movedSet)ln(this.removes,e,this.mirror)&&!this.movedSet.has(e.parentNode)||r(e);for(const e of this.addedSet)dn(this.droppedSet,e)||ln(this.removes,e,this.mirror)?dn(this.movedSet,e)?r(e):this.droppedSet.add(e):r(e);let o=null;while(n.length){let e=null;if(o){const t=this.mirror.getId(o.value.parentNode);const n=s(o.value);t!==-1&&n!==-1&&(e=o)}if(!e){let t=n.tail;while(t){const n=t;t=t.previous;if(n){const t=this.mirror.getId(n.value.parentNode);const r=s(n.value);if(r===-1)continue;if(t!==-1){e=n;break}{const t=n.value;if(t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const s=t.parentNode.host;const r=this.mirror.getId(s);if(r!==-1){e=n;break}}}}}}if(!e){while(n.head)n.removeNode(n.head.value);break}o=e.previous;n.removeNode(e.value);r(e.value)}const i={texts:this.texts.map((e=>({id:this.mirror.getId(e.node),value:e.value}))).filter((e=>!t.has(e.id))).filter((e=>this.mirror.has(e.id))),attributes:this.attributes.map((e=>{const{attributes:t}=e;if(typeof t.style==="string"){const n=JSON.stringify(e.styleDiff);const s=JSON.stringify(e._unchangedStyles);n.length<t.style.length&&(n+s).split("var(").length===t.style.split("var(").length&&(t.style=e.styleDiff)}return{id:this.mirror.getId(e.node),attributes:t}})).filter((e=>!t.has(e.id))).filter((e=>this.mirror.has(e.id))),removes:this.removes,adds:e};if(i.texts.length||i.attributes.length||i.removes.length||i.adds.length){this.texts=[];this.attributes=[];this.attributeMap=new WeakMap;this.removes=[];this.addedSet=new Set;this.movedSet=new Set;this.droppedSet=new Set;this.movedMap={};this.mutationCb(i)}};this.processMutation=e=>{if(!Ft(e.target,this.mirror))switch(e.type){case"characterData":{const t=e.target.textContent;Nt(e.target,this.blockClass,this.blockSelector,this.unblockSelector,false)||t===e.oldValue||this.texts.push({value:ht(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&t?this.maskTextFn?this.maskTextFn(t,Dt(e.target)):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target;let n=e.attributeName;let s=e.target.getAttribute(n);if(n==="value"){const n=Ae(t);const r=t.tagName;s=De(t,r,n);const o=Ee({maskInputOptions:this.maskInputOptions,tagName:r,type:n});const i=ht(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,o);s=Me({isMasked:i,element:t,value:s,maskInputFn:this.maskInputFn})}if(Nt(e.target,this.blockClass,this.blockSelector,this.unblockSelector,false)||s===e.oldValue)return;let r=this.attributeMap.get(e.target);if(t.tagName==="IFRAME"&&n==="src"&&!this.keepIframeSrcFn(s)){const e=sn(t);if(e)return;n="rr_src"}if(!r){r={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}};this.attributes.push(r);this.attributeMap.set(e.target,r)}n==="type"&&t.tagName==="INPUT"&&(e.oldValue||"").toLowerCase()==="password"&&t.setAttribute("data-rr-is-password","true");if(!at(t.tagName,n)){r.attributes[n]=it(this.doc,xe(t.tagName),xe(n),s,t,this.maskAttributeFn);if(n==="style"){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch(e){this.unattachedDoc=this.doc}const n=this.unattachedDoc.createElement("span");e.oldValue&&n.setAttribute("style",e.oldValue);for(const e of Array.from(t.style)){const s=t.style.getPropertyValue(e);const o=t.style.getPropertyPriority(e);s!==n.style.getPropertyValue(e)||o!==n.style.getPropertyPriority(e)?r.styleDiff[e]=o===""?s:[s,o]:r._unchangedStyles[e]=[s,o]}for(const e of Array.from(n.style))t.style.getPropertyValue(e)===""&&(r.styleDiff[e]=false)}}break}case"childList":if(Nt(e.target,this.blockClass,this.blockSelector,this.unblockSelector,true))return;e.addedNodes.forEach((t=>this.genAdds(t,e.target)));e.removedNodes.forEach((t=>{const n=this.mirror.getId(t);const s=me(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);if(!Nt(e.target,this.blockClass,this.blockSelector,this.unblockSelector,false)&&!Ft(t,this.mirror)&&Lt(t,this.mirror)){if(this.addedSet.has(t)){cn(this.addedSet,t);this.droppedSet.add(t)}else this.addedSet.has(e.target)&&n===-1||Pt(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[an(n,s)]?cn(this.movedSet,t):this.removes.push({parentId:s,id:n,isShadow:!(!me(e.target)||!ye(e.target))||void 0}));this.mapRemoves.push(t)}}));break}};this.genAdds=(e,t)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!this.addedSet.has(e)&&!this.movedSet.has(e)){if(this.mirror.hasNode(e)){if(Ft(e,this.mirror))return;this.movedSet.add(e);let n=null;t&&this.mirror.hasNode(t)&&(n=this.mirror.getId(t));n&&n!==-1&&(this.movedMap[an(this.mirror.getId(e),n)]=true)}else{this.addedSet.add(e);this.droppedSet.delete(e)}if(!Nt(e,this.blockClass,this.blockSelector,this.unblockSelector,false)){e.childNodes.forEach((e=>this.genAdds(e)));Ht(e)&&e.shadowRoot.childNodes.forEach((t=>{this.processedNodeManager.add(t,this);this.genAdds(t,e)}))}}}}init(e){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach((t=>{this[t]=e[t]}))}freeze(){this.frozen=true;this.canvasManager.freeze()}unfreeze(){this.frozen=false;this.canvasManager.unfreeze();this.emit()}isFrozen(){return this.frozen}lock(){this.locked=true;this.canvasManager.lock()}unlock(){this.locked=false;this.canvasManager.unlock();this.emit()}reset(){this.shadowDomManager.reset();this.canvasManager.reset()}}function cn(e,t){e.delete(t);t.childNodes.forEach((t=>cn(e,t)))}function ln(e,t,n){return e.length!==0&&un(e,t,n)}function un(e,t,n){let s=t.parentNode;while(s){const t=n.getId(s);if(e.some((e=>e.id===t)))return true;s=s.parentNode}return false}function dn(e,t){return e.size!==0&&hn(e,t)}function hn(e,t){const{parentNode:n}=t;return!!n&&(!!e.has(n)||hn(e,n))}let pn;function fn(e){pn=e}function mn(){pn=void 0}const yn=e=>{if(!pn)return e;const t=(...t)=>{try{return e(...t)}catch(e){if(pn&&pn(e)===true)return()=>{};throw e}};return t};const gn=[];function Sn(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0]}catch{}return e&&e.target}function kn(e,t){const n=new MutationBuffer;gn.push(n);n.init(e);let s=window.MutationObserver||window.__rrMutationObserver;const r=window?.Zone?.__symbol__?.("MutationObserver");r&&window[r]&&(s=window[r]);const o=new s(yn((t=>{e.onMutation&&e.onMutation(t)===false||n.processMutations.bind(n)(t)})));o.observe(t,{attributes:true,attributeOldValue:true,characterData:true,characterDataOldValue:true,childList:true,subtree:true});return o}function vn({mousemoveCb:e,sampling:t,doc:n,mirror:s}){if(t.mousemove===false)return()=>{};const r=typeof t.mousemove==="number"?t.mousemove:50;const o=typeof t.mousemoveCallback==="number"?t.mousemoveCallback:500;let i=[];let a;const c=Et(yn((t=>{const n=Date.now()-a;e(i.map((e=>{e.timeOffset-=n;return e})),t);i=[];a=null})),o);const l=yn(Et(yn((e=>{const t=Sn(e);const{clientX:n,clientY:r}=Bt(e)?e.changedTouches[0]:e;a||(a=Tt());i.push({x:n,y:r,id:s.getId(t),timeOffset:Tt()-a});c(typeof DragEvent!=="undefined"&&e instanceof DragEvent?Zt.Drag:e instanceof MouseEvent?Zt.MouseMove:Zt.TouchMove)})),r,{trailing:false}));const u=[_t("mousemove",l,n),_t("touchmove",l,n),_t("drag",l,n)];return yn((()=>{u.forEach((e=>e()))}))}function bn({mouseInteractionCb:e,doc:t,mirror:n,blockClass:s,blockSelector:r,unblockSelector:o,sampling:i}){if(i.mouseInteraction===false)return()=>{};const a=i.mouseInteraction===true||i.mouseInteraction===void 0?{}:i.mouseInteraction;const c=[];let l=null;const u=t=>i=>{const a=Sn(i);if(Nt(a,s,r,o,true))return;let c=null;let u=t;if("pointerType"in i){switch(i.pointerType){case"mouse":c=tn.Mouse;break;case"touch":c=tn.Touch;break;case"pen":c=tn.Pen;break}c===tn.Touch?en[t]===en.MouseDown?u="TouchStart":en[t]===en.MouseUp&&(u="TouchEnd"):c===tn.Pen}else Bt(i)&&(c=tn.Touch);if(c!==null){l=c;(u.startsWith("Touch")&&c===tn.Touch||u.startsWith("Mouse")&&c===tn.Mouse)&&(c=null)}else if(en[t]===en.Click){c=l;l=null}const d=Bt(i)?i.changedTouches[0]:i;if(!d)return;const h=n.getId(a);const{clientX:p,clientY:f}=d;yn(e)({type:en[u],id:h,x:p,y:f,...c!==null&&{pointerType:c}})};Object.keys(en).filter((e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&a[e]!==false)).forEach((e=>{let n=xe(e);const s=u(e);if(window.PointerEvent)switch(en[e]){case en.MouseDown:case en.MouseUp:n=n.replace("mouse","pointer");break;case en.TouchStart:case en.TouchEnd:return}c.push(_t(n,s,t))}));return yn((()=>{c.forEach((e=>e()))}))}function wn({scrollCb:e,doc:t,mirror:n,blockClass:s,blockSelector:r,unblockSelector:o,sampling:i}){const a=yn(Et(yn((i=>{const a=Sn(i);if(!a||Nt(a,s,r,o,true))return;const c=n.getId(a);if(a===t&&t.defaultView){const n=Rt(t.defaultView);e({id:c,x:n.left,y:n.top})}else e({id:c,x:a.scrollLeft,y:a.scrollTop})})),i.scroll||100));return _t("scroll",a,t)}function _n({viewportResizeCb:e},{win:t}){let n=-1;let s=-1;const r=yn(Et(yn((()=>{const t=Ot();const r=At();if(n!==t||s!==r){e({width:Number(r),height:Number(t)});n=t;s=r}})),200));return _t("resize",r,t)}const In=["INPUT","TEXTAREA","SELECT"];const Cn=new WeakMap;function En({inputCb:e,doc:t,mirror:n,blockClass:s,blockSelector:r,unblockSelector:o,ignoreClass:i,ignoreSelector:a,maskInputOptions:c,maskInputFn:l,sampling:u,userTriggeredOnInput:d,maskTextClass:h,unmaskTextClass:p,maskTextSelector:f,unmaskTextSelector:m}){function y(e){let n=Sn(e);const u=e.isTrusted;const y=n&&Te(n.tagName);y==="OPTION"&&(n=n.parentElement);if(!n||!y||In.indexOf(y)<0||Nt(n,s,r,o,true))return;const S=n;if(S.classList.contains(i)||a&&S.matches(a))return;const k=Ae(n);let v=De(S,y,k);let b=false;const w=Ee({maskInputOptions:c,tagName:y,type:k});const _=ht(n,h,f,p,m,w);k!=="radio"&&k!=="checkbox"||(b=n.checked);v=Me({isMasked:_,element:n,value:v,maskInputFn:l});g(n,d?{text:v,isChecked:b,userTriggered:u}:{text:v,isChecked:b});const I=n.name;k==="radio"&&I&&b&&t.querySelectorAll(`input[type="radio"][name="${I}"]`).forEach((e=>{if(e!==n){const t=Me({isMasked:_,element:e,value:De(e,y,k),maskInputFn:l});g(e,d?{text:t,isChecked:!b,userTriggered:false}:{text:t,isChecked:!b})}}))}function g(t,s){const r=Cn.get(t);if(!r||r.text!==s.text||r.isChecked!==s.isChecked){Cn.set(t,s);const r=n.getId(t);yn(e)({...s,id:r})}}const S=u.input==="last"?["change"]:["input","change"];const k=S.map((e=>_t(e,yn(y),t)));const v=t.defaultView;if(!v)return()=>{k.forEach((e=>e()))};const b=v.Object.getOwnPropertyDescriptor(v.HTMLInputElement.prototype,"value");const w=[[v.HTMLInputElement.prototype,"value"],[v.HTMLInputElement.prototype,"checked"],[v.HTMLSelectElement.prototype,"value"],[v.HTMLTextAreaElement.prototype,"value"],[v.HTMLSelectElement.prototype,"selectedIndex"],[v.HTMLOptionElement.prototype,"selected"]];b&&b.set&&k.push(...w.map((e=>Mt(e[0],e[1],{set(){yn(y)({target:this,isTrusted:false})}},false,v))));return yn((()=>{k.forEach((e=>e()))}))}function Mn(e){const t=[];function n(e,t){if(Pn("CSSGroupingRule")&&e.parentRule instanceof CSSGroupingRule||Pn("CSSMediaRule")&&e.parentRule instanceof CSSMediaRule||Pn("CSSSupportsRule")&&e.parentRule instanceof CSSSupportsRule||Pn("CSSConditionRule")&&e.parentRule instanceof CSSConditionRule){const n=Array.from(e.parentRule.cssRules);const s=n.indexOf(e);t.unshift(s)}else if(e.parentStyleSheet){const n=Array.from(e.parentStyleSheet.cssRules);const s=n.indexOf(e);t.unshift(s)}return t}return n(e,t)}function xn(e,t,n){let s,r;if(!e)return{};e.ownerNode?s=t.getId(e.ownerNode):r=n.getId(e);return{styleId:r,id:s}}function Tn({styleSheetRuleCb:e,mirror:t,stylesheetManager:n},{win:s}){if(!s.CSSStyleSheet||!s.CSSStyleSheet.prototype)return()=>{};const r=s.CSSStyleSheet.prototype.insertRule;s.CSSStyleSheet.prototype.insertRule=new Proxy(r,{apply:yn(((s,r,o)=>{const[i,a]=o;const{id:c,styleId:l}=xn(r,t,n.styleMirror);(c&&c!==-1||l&&l!==-1)&&e({id:c,styleId:l,adds:[{rule:i,index:a}]});return s.apply(r,o)}))});const o=s.CSSStyleSheet.prototype.deleteRule;s.CSSStyleSheet.prototype.deleteRule=new Proxy(o,{apply:yn(((s,r,o)=>{const[i]=o;const{id:a,styleId:c}=xn(r,t,n.styleMirror);(a&&a!==-1||c&&c!==-1)&&e({id:a,styleId:c,removes:[{index:i}]});return s.apply(r,o)}))});let i;if(s.CSSStyleSheet.prototype.replace){i=s.CSSStyleSheet.prototype.replace;s.CSSStyleSheet.prototype.replace=new Proxy(i,{apply:yn(((s,r,o)=>{const[i]=o;const{id:a,styleId:c}=xn(r,t,n.styleMirror);(a&&a!==-1||c&&c!==-1)&&e({id:a,styleId:c,replace:i});return s.apply(r,o)}))})}let a;if(s.CSSStyleSheet.prototype.replaceSync){a=s.CSSStyleSheet.prototype.replaceSync;s.CSSStyleSheet.prototype.replaceSync=new Proxy(a,{apply:yn(((s,r,o)=>{const[i]=o;const{id:a,styleId:c}=xn(r,t,n.styleMirror);(a&&a!==-1||c&&c!==-1)&&e({id:a,styleId:c,replaceSync:i});return s.apply(r,o)}))})}const c={};if(Bn("CSSGroupingRule"))c.CSSGroupingRule=s.CSSGroupingRule;else{Bn("CSSMediaRule")&&(c.CSSMediaRule=s.CSSMediaRule);Bn("CSSConditionRule")&&(c.CSSConditionRule=s.CSSConditionRule);Bn("CSSSupportsRule")&&(c.CSSSupportsRule=s.CSSSupportsRule)}const l={};Object.entries(c).forEach((([s,r])=>{l[s]={insertRule:r.prototype.insertRule,deleteRule:r.prototype.deleteRule};r.prototype.insertRule=new Proxy(l[s].insertRule,{apply:yn(((s,r,o)=>{const[i,a]=o;const{id:c,styleId:l}=xn(r.parentStyleSheet,t,n.styleMirror);(c&&c!==-1||l&&l!==-1)&&e({id:c,styleId:l,adds:[{rule:i,index:[...Mn(r),a||0]}]});return s.apply(r,o)}))});r.prototype.deleteRule=new Proxy(l[s].deleteRule,{apply:yn(((s,r,o)=>{const[i]=o;const{id:a,styleId:c}=xn(r.parentStyleSheet,t,n.styleMirror);(a&&a!==-1||c&&c!==-1)&&e({id:a,styleId:c,removes:[{index:[...Mn(r),i]}]});return s.apply(r,o)}))})}));return yn((()=>{s.CSSStyleSheet.prototype.insertRule=r;s.CSSStyleSheet.prototype.deleteRule=o;i&&(s.CSSStyleSheet.prototype.replace=i);a&&(s.CSSStyleSheet.prototype.replaceSync=a);Object.entries(c).forEach((([e,t])=>{t.prototype.insertRule=l[e].insertRule;t.prototype.deleteRule=l[e].deleteRule}))}))}function Rn({mirror:e,stylesheetManager:t},n){let s=null;s=n.nodeName==="#document"?e.getId(n):e.getId(n.host);const r=n.nodeName==="#document"?n.defaultView?.Document:n.ownerDocument?.defaultView?.ShadowRoot;const o=r?.prototype?Object.getOwnPropertyDescriptor(r?.prototype,"adoptedStyleSheets"):void 0;if(s===null||s===-1||!r||!o)return()=>{};Object.defineProperty(n,"adoptedStyleSheets",{configurable:o.configurable,enumerable:o.enumerable,get(){return o.get?.call(this)},set(e){const n=o.set?.call(this,e);if(s!==null&&s!==-1)try{t.adoptStyleSheets(e,s)}catch(e){}return n}});return yn((()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:o.configurable,enumerable:o.enumerable,get:o.get,set:o.set})}))}function On({styleDeclarationCb:e,mirror:t,ignoreCSSAttributes:n,stylesheetManager:s},{win:r}){const o=r.CSSStyleDeclaration.prototype.setProperty;r.CSSStyleDeclaration.prototype.setProperty=new Proxy(o,{apply:yn(((r,i,a)=>{const[c,l,u]=a;if(n.has(c))return o.apply(i,[c,l,u]);const{id:d,styleId:h}=xn(i.parentRule?.parentStyleSheet,t,s.styleMirror);(d&&d!==-1||h&&h!==-1)&&e({id:d,styleId:h,set:{property:c,value:l,priority:u},index:Mn(i.parentRule)});return r.apply(i,a)}))});const i=r.CSSStyleDeclaration.prototype.removeProperty;r.CSSStyleDeclaration.prototype.removeProperty=new Proxy(i,{apply:yn(((r,o,a)=>{const[c]=a;if(n.has(c))return i.apply(o,[c]);const{id:l,styleId:u}=xn(o.parentRule?.parentStyleSheet,t,s.styleMirror);(l&&l!==-1||u&&u!==-1)&&e({id:l,styleId:u,remove:{property:c},index:Mn(o.parentRule)});return r.apply(o,a)}))});return yn((()=>{r.CSSStyleDeclaration.prototype.setProperty=o;r.CSSStyleDeclaration.prototype.removeProperty=i}))}function An({mediaInteractionCb:e,blockClass:t,blockSelector:n,unblockSelector:s,mirror:r,sampling:o,doc:i}){const a=yn((i=>Et(yn((o=>{const a=Sn(o);if(!a||Nt(a,t,n,s,true))return;const{currentTime:c,volume:l,muted:u,playbackRate:d}=a;e({type:i,id:r.getId(a),currentTime:c,volume:l,muted:u,playbackRate:d})})),o.media||500)));const c=[_t("play",a(nn.Play),i),_t("pause",a(nn.Pause),i),_t("seeked",a(nn.Seeked),i),_t("volumechange",a(nn.VolumeChange),i),_t("ratechange",a(nn.RateChange),i)];return yn((()=>{c.forEach((e=>e()))}))}function Dn({fontCb:e,doc:t}){const n=t.defaultView;if(!n)return()=>{};const s=[];const r=new WeakMap;const o=n.FontFace;n.FontFace=function(e,t,n){const s=new o(e,t,n);r.set(s,{family:e,buffer:typeof t!=="string",descriptors:n,fontSource:typeof t==="string"?t:JSON.stringify(Array.from(new Uint8Array(t)))});return s};const i=xt(t.fonts,"add",(function(t){return function(n){Yt(yn((()=>{const t=r.get(n);if(t){e(t);r.delete(n)}})),0);return t.apply(this,[n])}}));s.push((()=>{n.FontFace=o}));s.push(i);return yn((()=>{s.forEach((e=>e()))}))}function Nn(e){const{doc:t,mirror:n,blockClass:s,blockSelector:r,unblockSelector:o,selectionCb:i}=e;let a=true;const c=yn((()=>{const e=t.getSelection();if(!e||a&&e?.isCollapsed)return;a=e.isCollapsed||false;const c=[];const l=e.rangeCount||0;for(let t=0;t<l;t++){const i=e.getRangeAt(t);const{startContainer:a,startOffset:l,endContainer:u,endOffset:d}=i;const h=Nt(a,s,r,o,true)||Nt(u,s,r,o,true);h||c.push({start:n.getId(a),startOffset:l,end:n.getId(u),endOffset:d})}i({ranges:c})}));c();return _t("selectionchange",c)}function Ln({doc:e,customElementCb:t}){const n=e.defaultView;if(!n||!n.customElements)return()=>{};const s=xt(n.customElements,"define",(function(e){return function(n,s,r){try{t({define:{name:n}})}catch(e){}return e.apply(this,[n,s,r])}}));return s}function Fn(e,t={}){const n=e.doc.defaultView;if(!n)return()=>{};let s;e.recordDOM&&(s=kn(e,e.doc));const r=vn(e);const o=bn(e);const i=wn(e);const a=_n(e,{win:n});const c=En(e);const l=An(e);let u=()=>{};let d=()=>{};let h=()=>{};let p=()=>{};if(e.recordDOM){u=Tn(e,{win:n});d=Rn(e,e.doc);h=On(e,{win:n});e.collectFonts&&(p=Dn(e))}const f=Nn(e);const m=Ln(e);const y=[];for(const t of e.plugins)y.push(t.observer(t.callback,n,t.options));return yn((()=>{gn.forEach((e=>e.reset()));s?.disconnect();r();o();i();a();c();l();u();d();h();p();f();m();y.forEach((e=>e()))}))}function Pn(e){return typeof window[e]!=="undefined"}function Bn(e){return Boolean(typeof window[e]!=="undefined"&&window[e].prototype&&"insertRule"in window[e].prototype&&"deleteRule"in window[e].prototype)}class CrossOriginIframeMirror{constructor(e){this.generateIdFn=e;this.iframeIdToRemoteIdMap=new WeakMap;this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,n,s){const r=n||this.getIdToRemoteIdMap(e);const o=s||this.getRemoteIdToIdMap(e);let i=r.get(t);if(!i){i=this.generateIdFn();r.set(t,i);o.set(i,t)}return i}getIds(e,t){const n=this.getIdToRemoteIdMap(e);const s=this.getRemoteIdToIdMap(e);return t.map((t=>this.getId(e,t,n,s)))}getRemoteId(e,t,n){const s=n||this.getRemoteIdToIdMap(e);if(typeof t!=="number")return t;const r=s.get(t);return r||-1}getRemoteIds(e,t){const n=this.getRemoteIdToIdMap(e);return t.map((t=>this.getRemoteId(e,t,n)))}reset(e){if(e){this.iframeIdToRemoteIdMap.delete(e);this.iframeRemoteIdToIdMap.delete(e)}else{this.iframeIdToRemoteIdMap=new WeakMap;this.iframeRemoteIdToIdMap=new WeakMap}}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);if(!t){t=new Map;this.iframeIdToRemoteIdMap.set(e,t)}return t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);if(!t){t=new Map;this.iframeRemoteIdToIdMap.set(e,t)}return t}}class IframeManagerNoop{constructor(){this.crossOriginIframeMirror=new CrossOriginIframeMirror(je);this.crossOriginIframeRootIdMap=new WeakMap}addIframe(){}addLoadListener(){}attachIframe(){}}class IframeManager{constructor(e){this.iframes=new WeakMap;this.crossOriginIframeMap=new WeakMap;this.crossOriginIframeMirror=new CrossOriginIframeMirror(je);this.crossOriginIframeRootIdMap=new WeakMap;this.mutationCb=e.mutationCb;this.wrappedEmit=e.wrappedEmit;this.stylesheetManager=e.stylesheetManager;this.recordCrossOriginIframes=e.recordCrossOriginIframes;this.crossOriginIframeStyleMirror=new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror));this.mirror=e.mirror;this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,true);e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:true});this.recordCrossOriginIframes&&e.contentWindow?.addEventListener("message",this.handleMessage.bind(this));this.loadListener?.(e);const n=sn(e);n&&n.adoptedStyleSheets&&n.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(n.adoptedStyleSheets,this.mirror.getId(n))}handleMessage(e){const t=e;if(t.data.type!=="rrweb"||t.origin!==t.data.origin)return;const n=e.source;if(!n)return;const s=this.crossOriginIframeMap.get(e.source);if(!s)return;const r=this.transformCrossOriginEvent(s,t.data.event);r&&this.wrappedEmit(r,t.data.isCheckout)}transformCrossOriginEvent(e,t){switch(t.type){case Qt.FullSnapshot:{this.crossOriginIframeMirror.reset(e);this.crossOriginIframeStyleMirror.reset(e);this.replaceIdOnNode(t.data.node,e);const n=t.data.node.id;this.crossOriginIframeRootIdMap.set(e,n);this.patchRootIdOnNode(t.data.node,n);return{timestamp:t.timestamp,type:Qt.IncrementalSnapshot,data:{source:Zt.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:true}}}case Qt.Meta:case Qt.Load:case Qt.DomContentLoaded:return false;case Qt.Plugin:return t;case Qt.Custom:this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]);return t;case Qt.IncrementalSnapshot:switch(t.data.source){case Zt.Mutation:t.data.adds.forEach((t=>{this.replaceIds(t,e,["parentId","nextId","previousId"]);this.replaceIdOnNode(t.node,e);const n=this.crossOriginIframeRootIdMap.get(e);n&&this.patchRootIdOnNode(t.node,n)}));t.data.removes.forEach((t=>{this.replaceIds(t,e,["parentId","id"])}));t.data.attributes.forEach((t=>{this.replaceIds(t,e,["id"])}));t.data.texts.forEach((t=>{this.replaceIds(t,e,["id"])}));return t;case Zt.Drag:case Zt.TouchMove:case Zt.MouseMove:t.data.positions.forEach((t=>{this.replaceIds(t,e,["id"])}));return t;case Zt.ViewportResize:return false;case Zt.MediaInteraction:case Zt.MouseInteraction:case Zt.Scroll:case Zt.CanvasMutation:case Zt.Input:this.replaceIds(t.data,e,["id"]);return t;case Zt.StyleSheetRule:case Zt.StyleDeclaration:this.replaceIds(t.data,e,["id"]);this.replaceStyleIds(t.data,e,["styleId"]);return t;case Zt.Font:return t;case Zt.Selection:t.data.ranges.forEach((t=>{this.replaceIds(t,e,["start","end"])}));return t;case Zt.AdoptedStyleSheet:this.replaceIds(t.data,e,["id"]);this.replaceStyleIds(t.data,e,["styleIds"]);t.data.styles?.forEach((t=>{this.replaceStyleIds(t,e,["styleId"])}));return t}}return false}replace(e,t,n,s){for(const r of s)(Array.isArray(t[r])||typeof t[r]==="number")&&(Array.isArray(t[r])?t[r]=e.getIds(n,t[r]):t[r]=e.getId(n,t[r]));return t}replaceIds(e,t,n){return this.replace(this.crossOriginIframeMirror,e,t,n)}replaceStyleIds(e,t,n){return this.replace(this.crossOriginIframeStyleMirror,e,t,n)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id","rootId"]);"childNodes"in e&&e.childNodes.forEach((e=>{this.replaceIdOnNode(e,t)}))}patchRootIdOnNode(e,t){e.type===pe.Document||e.rootId||(e.rootId=t);"childNodes"in e&&e.childNodes.forEach((e=>{this.patchRootIdOnNode(e,t)}))}}class ShadowDomManagerNoop{init(){}addShadowRoot(){}observeAttachShadow(){}reset(){}}class ShadowDomManager{constructor(e){this.shadowDoms=new WeakSet;this.restoreHandlers=[];this.mutationCb=e.mutationCb;this.scrollCb=e.scrollCb;this.bypassOptions=e.bypassOptions;this.mirror=e.mirror;this.init()}init(){this.reset();this.patchAttachShadow(Element,document)}addShadowRoot(e,t){if(!ye(e))return;if(this.shadowDoms.has(e))return;this.shadowDoms.add(e);this.bypassOptions.canvasManager.addShadowRoot(e);const n=kn({...this.bypassOptions,doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this},e);this.restoreHandlers.push((()=>n.disconnect()));this.restoreHandlers.push(wn({...this.bypassOptions,scrollCb:this.scrollCb,doc:e,mirror:this.mirror}));Yt((()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host));this.restoreHandlers.push(Rn({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))}),0)}observeAttachShadow(e){const t=sn(e);const n=rn(e);t&&n&&this.patchAttachShadow(n.Element,t)}patchAttachShadow(e,t){const n=this;this.restoreHandlers.push(xt(e.prototype,"attachShadow",(function(e){return function(s){const r=e.call(this,s);this.shadowRoot&&Vt(this)&&n.addShadowRoot(this.shadowRoot,t);return r}})))}reset(){this.restoreHandlers.forEach((e=>{try{e()}catch(e){}}));this.restoreHandlers=[];this.shadowDoms=new WeakSet;this.bypassOptions.canvasManager.resetShadowRoots()}}var zn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var Un=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(var Wn=0;Wn<zn.length;Wn++)Un[zn.charCodeAt(Wn)]=Wn;class CanvasManagerNoop{reset(){}freeze(){}unfreeze(){}lock(){}unlock(){}snapshot(){}addWindow(){}addShadowRoot(){}resetShadowRoots(){}}class StylesheetManager{constructor(e){this.trackedLinkElements=new WeakSet;this.styleMirror=new StyleSheetMirror;this.mutationCb=e.mutationCb;this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]});this.trackLinkElement(e)}trackLinkElement(e){if(!this.trackedLinkElements.has(e)){this.trackedLinkElements.add(e);this.trackStylesheetInLinkElement(e)}}adoptStyleSheets(e,t){if(e.length===0)return;const n={id:t,styleIds:[]};const s=[];for(const t of e){let e;if(this.styleMirror.has(t))e=this.styleMirror.getId(t);else{e=this.styleMirror.add(t);s.push({styleId:e,rules:Array.from(t.rules||CSSRule,((e,t)=>({rule:be(e),index:t})))})}n.styleIds.push(e)}s.length>0&&(n.styles=s);this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset();this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}class ProcessedNodeManager{constructor(){this.nodeMap=new WeakMap;this.active=false}inOtherBuffer(e,t){const n=this.nodeMap.get(e);return n&&Array.from(n).some((e=>e!==t))}add(e,t){if(!this.active){this.active=true;Gt((()=>{this.nodeMap=new WeakMap;this.active=false}))}this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(t))}destroy(){}}let Hn;let jn;try{if(Array.from([1],(e=>e*2))[0]!==2){const e=document.createElement("iframe");document.body.appendChild(e);Array.from=e.contentWindow?.Array.from||Array.from;document.body.removeChild(e)}}catch(e){console.debug("Unable to override Array.from",e)}const $n=Ce();function qn(e={}){const{emit:t,checkoutEveryNms:n,checkoutEveryNth:s,blockClass:r="rr-block",blockSelector:o=null,unblockSelector:i=null,ignoreClass:a="rr-ignore",ignoreSelector:c=null,maskAllText:l=false,maskTextClass:u="rr-mask",unmaskTextClass:d=null,maskTextSelector:h=null,unmaskTextSelector:p=null,inlineStylesheet:f=true,maskAllInputs:m,maskInputOptions:y,slimDOMOptions:g,maskAttributeFn:S,maskInputFn:k,maskTextFn:v,maxCanvasSize:b=null,packFn:w,sampling:_={},dataURLOptions:I={},mousemoveWait:C,recordDOM:E=true,recordCanvas:M=false,recordCrossOriginIframes:x=false,recordAfter:T=(e.recordAfter==="DOMContentLoaded"?e.recordAfter:"load"),userTriggeredOnInput:R=false,collectFonts:O=false,inlineImages:A=false,plugins:D,keepIframeSrcFn:N=()=>false,ignoreCSSAttributes:L=new Set([]),errorHandler:F,onMutation:P,getCanvasManager:B}=e;fn(F);const z=!x||window.parent===window;let U=false;if(!z)try{window.parent.document&&(U=false)}catch(e){U=true}if(z&&!t)throw new Error("emit function is required");if(!z&&!U)return()=>{};C!==void 0&&_.mousemove===void 0&&(_.mousemove=C);$n.reset();const W=m===true?{color:true,date:true,"datetime-local":true,email:true,month:true,number:true,range:true,search:true,tel:true,text:true,time:true,url:true,week:true,textarea:true,select:true,radio:true,checkbox:true}:y!==void 0?y:{};const H=g===true||g==="all"?{script:true,comment:true,headFavicon:true,headWhitespace:true,headMetaSocial:true,headMetaRobots:true,headMetaHttpEquiv:true,headMetaVerification:true,headMetaAuthorship:g==="all",headMetaDescKeywords:g==="all"}:g||{};zt();let j;let $=0;const q=e=>{for(const t of D||[])t.eventProcessor&&(e=t.eventProcessor(e));w&&!U&&(e=w(e));return e};Hn=(e,r)=>{const o=e;o.timestamp=Tt();!gn[0]?.isFrozen()||o.type===Qt.FullSnapshot||o.type===Qt.IncrementalSnapshot&&o.data.source===Zt.Mutation||gn.forEach((e=>e.unfreeze()));if(z)t?.(q(o),r);else if(U){const e={type:"rrweb",event:q(o),origin:window.location.origin,isCheckout:r};window.parent.postMessage(e,"*")}if(o.type===Qt.FullSnapshot){j=o;$=0}else if(o.type===Qt.IncrementalSnapshot){if(o.data.source===Zt.Mutation&&o.data.isAttachIframe)return;$++;const e=s&&$>=s;const t=n&&j&&o.timestamp-j.timestamp>n;(e||t)&&te(true)}};const V=e=>{Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.Mutation,...e}})};const K=e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.Scroll,...e}});const J=e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.CanvasMutation,...e}});const G=e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.AdoptedStyleSheet,...e}});const Y=new StylesheetManager({mutationCb:V,adoptedStyleSheetCb:G});const X=typeof __RRWEB_EXCLUDE_IFRAME__==="boolean"&&__RRWEB_EXCLUDE_IFRAME__?new IframeManagerNoop:new IframeManager({mirror:$n,mutationCb:V,stylesheetManager:Y,recordCrossOriginIframes:x,wrappedEmit:Hn});for(const e of D||[])e.getMirror&&e.getMirror({nodeMirror:$n,crossOriginIframeMirror:X.crossOriginIframeMirror,crossOriginIframeStyleMirror:X.crossOriginIframeStyleMirror});const Q=new ProcessedNodeManager;const Z=Kn(B,{mirror:$n,win:window,mutationCb:e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.CanvasMutation,...e}}),recordCanvas:M,blockClass:r,blockSelector:o,unblockSelector:i,maxCanvasSize:b,sampling:_.canvas,dataURLOptions:I,errorHandler:F});const ee=typeof __RRWEB_EXCLUDE_SHADOW_DOM__==="boolean"&&__RRWEB_EXCLUDE_SHADOW_DOM__?new ShadowDomManagerNoop:new ShadowDomManager({mutationCb:V,scrollCb:K,bypassOptions:{onMutation:P,blockClass:r,blockSelector:o,unblockSelector:i,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:h,unmaskTextSelector:p,inlineStylesheet:f,maskInputOptions:W,dataURLOptions:I,maskAttributeFn:S,maskTextFn:v,maskInputFn:k,recordCanvas:M,inlineImages:A,sampling:_,slimDOMOptions:H,iframeManager:X,stylesheetManager:Y,canvasManager:Z,keepIframeSrcFn:N,processedNodeManager:Q},mirror:$n});const te=(e=false)=>{if(!E)return;Hn({type:Qt.Meta,data:{href:window.location.href,width:At(),height:Ot()}},e);Y.reset();ee.init();gn.forEach((e=>e.lock()));const t=wt(document,{mirror:$n,blockClass:r,blockSelector:o,unblockSelector:i,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:h,unmaskTextSelector:p,inlineStylesheet:f,maskAllInputs:W,maskAttributeFn:S,maskInputFn:k,maskTextFn:v,slimDOM:H,dataURLOptions:I,recordCanvas:M,inlineImages:A,onSerialize:e=>{Ut(e,$n)&&X.addIframe(e);Wt(e,$n)&&Y.trackLinkElement(e);Ht(e)&&ee.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{X.attachIframe(e,t);e.contentWindow&&Z.addWindow(e.contentWindow);ee.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{Y.attachLinkElement(e,t)},keepIframeSrcFn:N});if(!t)return console.warn("Failed to snapshot the document");Hn({type:Qt.FullSnapshot,data:{node:t,initialOffset:Rt(window)}});gn.forEach((e=>e.unlock()));document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&Y.adoptStyleSheets(document.adoptedStyleSheets,$n.getId(document))};jn=te;try{const e=[];const t=e=>yn(Fn)({onMutation:P,mutationCb:V,mousemoveCb:(e,t)=>Hn({type:Qt.IncrementalSnapshot,data:{source:t,positions:e}}),mouseInteractionCb:e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.MouseInteraction,...e}}),scrollCb:K,viewportResizeCb:e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.ViewportResize,...e}}),inputCb:e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.Input,...e}}),mediaInteractionCb:e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.MediaInteraction,...e}}),styleSheetRuleCb:e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.StyleSheetRule,...e}}),styleDeclarationCb:e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.StyleDeclaration,...e}}),canvasMutationCb:J,fontCb:e=>Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.Font,...e}}),selectionCb:e=>{Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.Selection,...e}})},customElementCb:e=>{Hn({type:Qt.IncrementalSnapshot,data:{source:Zt.CustomElement,...e}})},blockClass:r,ignoreClass:a,ignoreSelector:c,maskAllText:l,maskTextClass:u,unmaskTextClass:d,maskTextSelector:h,unmaskTextSelector:p,maskInputOptions:W,inlineStylesheet:f,sampling:_,recordDOM:E,recordCanvas:M,inlineImages:A,userTriggeredOnInput:R,collectFonts:O,doc:e,maskAttributeFn:S,maskInputFn:k,maskTextFn:v,keepIframeSrcFn:N,blockSelector:o,unblockSelector:i,slimDOMOptions:H,dataURLOptions:I,mirror:$n,iframeManager:X,stylesheetManager:Y,shadowDomManager:ee,processedNodeManager:Q,canvasManager:Z,ignoreCSSAttributes:L,plugins:D?.filter((e=>e.observer))?.map((e=>({observer:e.observer,options:e.options,callback:t=>Hn({type:Qt.Plugin,data:{plugin:e.name,payload:t}})})))||[]},{});X.addLoadListener((n=>{try{e.push(t(n.contentDocument))}catch(e){console.warn(e)}}));const n=()=>{te();e.push(t(document))};if(document.readyState==="interactive"||document.readyState==="complete")n();else{e.push(_t("DOMContentLoaded",(()=>{Hn({type:Qt.DomContentLoaded,data:{}});T==="DOMContentLoaded"&&n()})));e.push(_t("load",(()=>{Hn({type:Qt.Load,data:{}});T==="load"&&n()}),window))}return()=>{e.forEach((e=>e()));Q.destroy();jn=void 0;mn()}}catch(e){console.warn(e)}}function Vn(e){if(!jn)throw new Error("please take full snapshot after start recording");jn(e)}qn.mirror=$n;qn.takeFullSnapshot=Vn;function Kn(e,t){try{return e?e(t):new CanvasManagerNoop}catch{console.warn("Unable to initialize CanvasManager");return new CanvasManagerNoop}}var Jn;!function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"}(Jn||(Jn={}));const Gn=3;const Yn=5;function Xn(e){const t=e>9999999999;return t?e:e*1e3}function Qn(e){const t=e>9999999999;return t?e/1e3:e}function Zn(e,n){if(n.category!=="sentry.transaction"){["ui.click","ui.input"].includes(n.category)?e.triggerUserActivity():e.checkAndHandleExpiredSession();e.addUpdate((()=>{e.throttledAddEvent({type:Qt.Custom,timestamp:(n.timestamp||0)*1e3,data:{tag:"breadcrumb",payload:t(n,10,1e3)}});return n.category==="console"}))}}const es="button,a";function ts(e){const t=e.closest(es);return t||e}function ns(e){const t=ss(e);return t&&t instanceof Element?ts(t):t}function ss(e){return rs(e)?e.target:e}function rs(e){return typeof e==="object"&&!!e&&"target"in e}let os;function is(e){if(!os){os=[];as()}os.push(e);return()=>{const t=os?os.indexOf(e):-1;t>-1&&os.splice(t,1)}}function as(){n(q,"open",(function(e){return function(...t){if(os)try{os.forEach((e=>e()))}catch(e){}return e.apply(q,t)}}))}const cs=new Set([Zt.Mutation,Zt.StyleSheetRule,Zt.StyleDeclaration,Zt.AdoptedStyleSheet,Zt.CanvasMutation,Zt.Selection,Zt.MediaInteraction]);function ls(e,t,n){e.handleClick(t,n)}class ClickDetector{constructor(e,t,n=Zn){this._lastMutation=0;this._lastScroll=0;this._clicks=[];this._timeout=t.timeout/1e3;this._threshold=t.threshold/1e3;this._scrollTimeout=t.scrollTimeout/1e3;this._replay=e;this._ignoreSelector=t.ignoreSelector;this._addBreadcrumbEvent=n}addListeners(){const e=is((()=>{this._lastMutation=ps()}));this._teardown=()=>{e();this._clicks=[];this._lastMutation=0;this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown();this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(e,t){if(ds(t,this._ignoreSelector)||!hs(e))return;const n={timestamp:Qn(e.timestamp),clickBreadcrumb:e,clickCount:0,node:t};if(!this._clicks.some((e=>e.node===n.node&&Math.abs(e.timestamp-n.timestamp)<1))){this._clicks.push(n);this._clicks.length===1&&this._scheduleCheckClicks()}}registerMutation(e=Date.now()){this._lastMutation=Qn(e)}registerScroll(e=Date.now()){this._lastScroll=Qn(e)}registerClick(e){const t=ts(e);this._handleMultiClick(t)}_handleMultiClick(e){this._getClicks(e).forEach((e=>{e.clickCount++}))}_getClicks(e){return this._clicks.filter((t=>t.node===e))}_checkClicks(){const e=[];const t=ps();this._clicks.forEach((n=>{!n.mutationAfter&&this._lastMutation&&(n.mutationAfter=n.timestamp<=this._lastMutation?this._lastMutation-n.timestamp:void 0);!n.scrollAfter&&this._lastScroll&&(n.scrollAfter=n.timestamp<=this._lastScroll?this._lastScroll-n.timestamp:void 0);n.timestamp+this._timeout<=t&&e.push(n)}));for(const t of e){const e=this._clicks.indexOf(t);if(e>-1){this._generateBreadcrumbs(t);this._clicks.splice(e,1)}}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(e){const t=this._replay;const n=e.scrollAfter&&e.scrollAfter<=this._scrollTimeout;const s=e.mutationAfter&&e.mutationAfter<=this._threshold;const r=!n&&!s;const{clickCount:o,clickBreadcrumb:i}=e;if(r){const n=Math.min(e.mutationAfter||this._timeout,this._timeout)*1e3;const s=n<this._timeout*1e3?"mutation":"timeout";const r={type:"default",message:i.message,timestamp:i.timestamp,category:"ui.slowClickDetected",data:{...i.data,url:q.location.href,route:t.getCurrentRoute(),timeAfterClickMs:n,endReason:s,clickCount:o||1}};this._addBreadcrumbEvent(t,r)}else if(o>1){const e={type:"default",message:i.message,timestamp:i.timestamp,category:"ui.multiClick",data:{...i.data,url:q.location.href,route:t.getCurrentRoute(),clickCount:o,metric:true}};this._addBreadcrumbEvent(t,e)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout);this._checkClickTimeout=D((()=>this._checkClicks()),1e3)}}const us=["A","BUTTON","INPUT"];function ds(e,t){return!us.includes(e.tagName)||(e.tagName==="INPUT"&&!["submit","button"].includes(e.getAttribute("type")||"")||(!(e.tagName!=="A"||!(e.hasAttribute("download")||e.hasAttribute("target")&&e.getAttribute("target")!=="_self"))||!(!t||!e.matches(t))))}function hs(e){return!!(e.data&&typeof e.data.nodeId==="number"&&e.timestamp)}function ps(){return Date.now()/1e3}function fs(e,t){try{if(!ms(t))return;const{source:n}=t.data;cs.has(n)&&e.registerMutation(t.timestamp);n===Zt.Scroll&&e.registerScroll(t.timestamp);if(ys(t)){const{type:n,id:s}=t.data;const r=qn.mirror.getNode(s);r instanceof HTMLElement&&n===en.Click&&e.registerClick(r)}}catch{}}function ms(e){return e.type===Gn}function ys(e){return e.data.source===Zt.MouseInteraction}function gs(e){return{timestamp:Date.now()/1e3,type:"default",...e}}var Ss=(e=>{e[e.Document=0]="Document";e[e.DocumentType=1]="DocumentType";e[e.Element=2]="Element";e[e.Text=3]="Text";e[e.CDATA=4]="CDATA";e[e.Comment=5]="Comment";return e})(Ss||{});const ks=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled","data-sentry-component"]);function vs(e){const t={};!e["data-sentry-component"]&&e["data-sentry-element"]&&(e["data-sentry-component"]=e["data-sentry-element"]);for(const n in e)if(ks.has(n)){let s=n;n!=="data-testid"&&n!=="data-test-id"||(s="testId");t[s]=e[n]}return t}const bs=e=>t=>{if(!e.isEnabled())return;const n=_s(t);if(!n)return;const s=t.name==="click";const r=s?t.event:void 0;!(s&&e.clickDetector&&r&&r.target)||r.altKey||r.metaKey||r.ctrlKey||r.shiftKey||ls(e.clickDetector,n,ns(t.event));Zn(e,n)};function ws(e,t){const n=qn.mirror.getId(e);const s=n&&qn.mirror.getNode(n);const r=s&&qn.mirror.getMeta(s);const o=r&&Cs(r)?r:null;return{message:t,data:o?{nodeId:n,node:{id:n,tagName:o.tagName,textContent:Array.from(o.childNodes).map((e=>e.type===Ss.Text&&e.textContent)).filter(Boolean).map((e=>e.trim())).join(""),attributes:vs(o.attributes)}}:{}}}function _s(e){const{target:t,message:n}=Is(e);return gs({category:`ui.${e.name}`,...ws(t,n)})}function Is(e){const t=e.name==="click";let n;let r=null;try{r=t?ns(e.event):ss(e.event);n=s(r,{maxStringLength:200})||"<unknown>"}catch(e){n="<unknown>"}return{target:r,message:n}}function Cs(e){return e.type===Ss.Element}function Es(e,t){if(!e.isEnabled())return;e.updateUserActivity();const n=Ms(t);n&&Zn(e,n)}function Ms(e){const{metaKey:t,shiftKey:n,ctrlKey:r,altKey:o,key:i,target:a}=e;if(!a||xs(a)||!i)return null;const c=t||r||o;const l=i.length===1;if(!c&&l)return null;const u=s(a,{maxStringLength:200})||"<unknown>";const d=ws(a,u);return gs({category:"ui.keyDown",message:u,data:{...d.data,metaKey:t,shiftKey:n,ctrlKey:r,altKey:o,key:i}})}function xs(e){return e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable}const Ts={resource:Fs,paint:Ns,navigation:Ls};function Rs(e,t){return({metric:n})=>{t.replayPerformanceEntries.push(e(n))}}function Os(e){return e.map(As).filter(Boolean)}function As(e){const t=Ts[e.entryType];return t?t(e):null}function Ds(e){return((r()||q.performance.timeOrigin)+e)/1e3}function Ns(e){const{duration:t,entryType:n,name:s,startTime:r}=e;const o=Ds(r);return{type:n,name:s,start:o,end:o+t,data:void 0}}function Ls(e){const{entryType:t,name:n,decodedBodySize:s,duration:r,domComplete:o,encodedBodySize:i,domContentLoadedEventStart:a,domContentLoadedEventEnd:c,domInteractive:l,loadEventStart:u,loadEventEnd:d,redirectCount:h,startTime:p,transferSize:f,type:m}=e;return r===0?null:{type:`${t}.${m}`,start:Ds(p),end:Ds(o),name:n,data:{size:f,decodedBodySize:s,encodedBodySize:i,duration:r,domInteractive:l,domContentLoadedEventStart:a,domContentLoadedEventEnd:c,loadEventStart:u,loadEventEnd:d,domComplete:o,redirectCount:h}}}function Fs(e){const{entryType:t,initiatorType:n,name:s,responseEnd:r,startTime:o,decodedBodySize:i,encodedBodySize:a,responseStatus:c,transferSize:l}=e;return["fetch","xmlhttprequest"].includes(n)?null:{type:`${t}.${n}`,start:Ds(o),end:Ds(r),name:s,data:{size:l,statusCode:c,decodedBodySize:i,encodedBodySize:a}}}function Ps(e){const t=e.entries[e.entries.length-1];const n=t?.element?[t.element]:void 0;return Hs(e,"largest-contentful-paint",n)}function Bs(e){return e.sources!==void 0}function zs(e){const t=[];const n=[];for(const s of e.entries)if(Bs(s)){const e=[];for(const t of s.sources)if(t.node){n.push(t.node);const s=qn.mirror.getId(t.node);s&&e.push(s)}t.push({value:s.value,nodeIds:e.length?e:void 0})}return Hs(e,"cumulative-layout-shift",n,t)}function Us(e){const t=e.entries[e.entries.length-1];const n=t?.target?[t.target]:void 0;return Hs(e,"first-input-delay",n)}function Ws(e){const t=e.entries[e.entries.length-1];const n=t?.target?[t.target]:void 0;return Hs(e,"interaction-to-next-paint",n)}function Hs(e,t,n,s){const r=e.value;const o=e.rating;const i=Ds(r);return{type:"web-vital",name:t,start:i,end:i,data:{value:r,size:r,rating:o,nodeIds:n?n.map((e=>qn.mirror.getId(e))):void 0,attributions:s}}}function js(e){function t(t){e.performanceEntries.includes(t)||e.performanceEntries.push(t)}function n({entries:e}){e.forEach(t)}const s=[];["navigation","paint","resource"].forEach((e=>{s.push(N(e,n))}));s.push(L(Rs(Ps,e)),F(Rs(zs,e)),P(Rs(Us,e)),B(Rs(Ws,e)));return()=>{s.forEach((e=>e()))}}const $s=typeof __SENTRY_DEBUG__==="undefined"||__SENTRY_DEBUG__;const qs='var t=Uint8Array,n=Uint16Array,r=Int32Array,e=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(t,e){for(var i=new n(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];var a=new r(i[30]);for(s=1;s<30;++s)for(var o=i[s];o<i[s+1];++o)a[o]=o-i[s]<<5|s;return{b:i,r:a}},o=a(e,2),h=o.b,f=o.r;h[28]=258,f[258]=28;for(var l=a(i,0).r,u=new n(32768),c=0;c<32768;++c){var v=(43690&c)>>1|(21845&c)<<1;v=(61680&(v=(52428&v)>>2|(13107&v)<<2))>>4|(3855&v)<<4,u[c]=((65280&v)>>8|(255&v)<<8)>>1}var d=function(t,r,e){for(var i=t.length,s=0,a=new n(r);s<i;++s)t[s]&&++a[t[s]-1];var o,h=new n(r);for(s=1;s<r;++s)h[s]=h[s-1]+a[s-1]<<1;if(e){o=new n(1<<r);var f=15-r;for(s=0;s<i;++s)if(t[s])for(var l=s<<4|t[s],c=r-t[s],v=h[t[s]-1]++<<c,d=v|(1<<c)-1;v<=d;++v)o[u[v]>>f]=l}else for(o=new n(i),s=0;s<i;++s)t[s]&&(o[s]=u[h[t[s]-1]++]>>15-t[s]);return o},p=new t(288);for(c=0;c<144;++c)p[c]=8;for(c=144;c<256;++c)p[c]=9;for(c=256;c<280;++c)p[c]=7;for(c=280;c<288;++c)p[c]=8;var g=new t(32);for(c=0;c<32;++c)g[c]=5;var w=d(p,9,0),y=d(g,5,0),m=function(t){return(t+7)/8|0},b=function(n,r,e){return(null==e||e>n.length)&&(e=n.length),new t(n.subarray(r,e))},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(t,n,r){var e=new Error(n||M[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,E),!r)throw e;return e},z=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8},_=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8,t[e+2]|=r>>16},x=function(r,e){for(var i=[],s=0;s<r.length;++s)r[s]&&i.push({s:s,f:r[s]});var a=i.length,o=i.slice();if(!a)return{t:F,l:0};if(1==a){var h=new t(i[0].s+1);return h[i[0].s]=1,{t:h,l:1}}i.sort((function(t,n){return t.f-n.f})),i.push({s:-1,f:25001});var f=i[0],l=i[1],u=0,c=1,v=2;for(i[0]={s:-1,f:f.f+l.f,l:f,r:l};c!=a-1;)f=i[i[u].f<i[v].f?u++:v++],l=i[u!=c&&i[u].f<i[v].f?u++:v++],i[c++]={s:-1,f:f.f+l.f,l:f,r:l};var d=o[0].s;for(s=1;s<a;++s)o[s].s>d&&(d=o[s].s);var p=new n(d+1),g=A(i[c-1],p,0);if(g>e){s=0;var w=0,y=g-e,m=1<<y;for(o.sort((function(t,n){return p[n.s]-p[t.s]||t.f-n.f}));s<a;++s){var b=o[s].s;if(!(p[b]>e))break;w+=m-(1<<g-p[b]),p[b]=e}for(w>>=y;w>0;){var M=o[s].s;p[M]<e?w-=1<<e-p[M]++-1:++s}for(;s>=0&&w;--s){var E=o[s].s;p[E]==e&&(--p[E],++w)}g=e}return{t:new t(p),l:g}},A=function(t,n,r){return-1==t.s?Math.max(A(t.l,n,r+1),A(t.r,n,r+1)):n[t.s]=r},D=function(t){for(var r=t.length;r&&!t[--r];);for(var e=new n(++r),i=0,s=t[0],a=1,o=function(t){e[i++]=t},h=1;h<=r;++h)if(t[h]==s&&h!=r)++a;else{if(!s&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(s),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(s);a=1,s=t[h]}return{c:e.subarray(0,i),n:r}},T=function(t,n){for(var r=0,e=0;e<n.length;++e)r+=t[e]*n[e];return r},k=function(t,n,r){var e=r.length,i=m(n+2);t[i]=255&e,t[i+1]=e>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<e;++s)t[i+s+4]=r[s];return 8*(i+4+e)},U=function(t,r,a,o,h,f,l,u,c,v,m){z(r,m++,a),++h[256];for(var b=x(h,15),M=b.t,E=b.l,A=x(f,15),U=A.t,C=A.l,F=D(M),I=F.c,S=F.n,L=D(U),O=L.c,j=L.n,q=new n(19),B=0;B<I.length;++B)++q[31&I[B]];for(B=0;B<O.length;++B)++q[31&O[B]];for(var G=x(q,7),H=G.t,J=G.l,K=19;K>4&&!H[s[K-1]];--K);var N,P,Q,R,V=v+5<<3,W=T(h,p)+T(f,g)+l,X=T(h,M)+T(f,U)+l+14+3*K+T(q,H)+2*q[16]+3*q[17]+7*q[18];if(c>=0&&V<=W&&V<=X)return k(r,m,t.subarray(c,c+v));if(z(r,m,1+(X<W)),m+=2,X<W){N=d(M,E,0),P=M,Q=d(U,C,0),R=U;var Y=d(H,J,0);z(r,m,S-257),z(r,m+5,j-1),z(r,m+10,K-4),m+=14;for(B=0;B<K;++B)z(r,m+3*B,H[s[B]]);m+=3*K;for(var Z=[I,O],$=0;$<2;++$){var tt=Z[$];for(B=0;B<tt.length;++B){var nt=31&tt[B];z(r,m,Y[nt]),m+=H[nt],nt>15&&(z(r,m,tt[B]>>5&127),m+=tt[B]>>12)}}}else N=w,P=p,Q=y,R=g;for(B=0;B<u;++B){var rt=o[B];if(rt>255){_(r,m,N[(nt=rt>>18&31)+257]),m+=P[nt+257],nt>7&&(z(r,m,rt>>23&31),m+=e[nt]);var et=31&rt;_(r,m,Q[et]),m+=R[et],et>3&&(_(r,m,rt>>5&8191),m+=i[et])}else _(r,m,N[rt]),m+=P[rt]}return _(r,m,N[256]),m+P[256]},C=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new t(0),I=function(){for(var t=new Int32Array(256),n=0;n<256;++n){for(var r=n,e=9;--e;)r=(1&r&&-306674912)^r>>>1;t[n]=r}return t}(),S=function(){var t=-1;return{p:function(n){for(var r=t,e=0;e<n.length;++e)r=I[255&r^n[e]]^r>>>8;t=r},d:function(){return~t}}},L=function(){var t=1,n=0;return{p:function(r){for(var e=t,i=n,s=0|r.length,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)i+=e+=r[a];e=(65535&e)+15*(e>>16),i=(65535&i)+15*(i>>16)}t=e,n=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(n%=65521))<<8|n>>8}}},O=function(s,a,o,h,u){if(!u&&(u={l:1},a.dictionary)){var c=a.dictionary.subarray(-32768),v=new t(c.length+s.length);v.set(c),v.set(s,c.length),s=v,u.w=c.length}return function(s,a,o,h,u,c){var v=c.z||s.length,d=new t(h+v+5*(1+Math.ceil(v/7e3))+u),p=d.subarray(h,d.length-u),g=c.l,w=7&(c.r||0);if(a){w&&(p[0]=c.r>>3);for(var y=C[a-1],M=y>>13,E=8191&y,z=(1<<o)-1,_=c.p||new n(32768),x=c.h||new n(z+1),A=Math.ceil(o/3),D=2*A,T=function(t){return(s[t]^s[t+1]<<A^s[t+2]<<D)&z},F=new r(25e3),I=new n(288),S=new n(32),L=0,O=0,j=c.i||0,q=0,B=c.w||0,G=0;j+2<v;++j){var H=T(j),J=32767&j,K=x[H];if(_[J]=K,x[H]=J,B<=j){var N=v-j;if((L>7e3||q>24576)&&(N>423||!g)){w=U(s,p,0,F,I,S,O,q,G,j-G,w),q=L=O=0,G=j;for(var P=0;P<286;++P)I[P]=0;for(P=0;P<30;++P)S[P]=0}var Q=2,R=0,V=E,W=J-K&32767;if(N>2&&H==T(j-W))for(var X=Math.min(M,N)-1,Y=Math.min(32767,j),Z=Math.min(258,N);W<=Y&&--V&&J!=K;){if(s[j+Q]==s[j+Q-W]){for(var $=0;$<Z&&s[j+$]==s[j+$-W];++$);if($>Q){if(Q=$,R=W,$>X)break;var tt=Math.min(W,$-2),nt=0;for(P=0;P<tt;++P){var rt=j-W+P&32767,et=rt-_[rt]&32767;et>nt&&(nt=et,K=rt)}}}W+=(J=K)-(K=_[J])&32767}if(R){F[q++]=268435456|f[Q]<<18|l[R];var it=31&f[Q],st=31&l[R];O+=e[it]+i[st],++I[257+it],++S[st],B=j+Q,++L}else F[q++]=s[j],++I[s[j]]}}for(j=Math.max(j,B);j<v;++j)F[q++]=s[j],++I[s[j]];w=U(s,p,g,F,I,S,O,q,G,j-G,w),g||(c.r=7&w|p[w/8|0]<<3,w-=7,c.h=x,c.p=_,c.i=j,c.w=B)}else{for(j=c.w||0;j<v+g;j+=65535){var at=j+65535;at>=v&&(p[w/8|0]=g,at=v),w=k(p,w+1,s.subarray(j,at))}c.i=v}return b(d,0,h+m(w)+u)}(s,null==a.level?6:a.level,null==a.mem?u.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):20:12+a.mem,o,h,u)},j=function(t,n,r){for(;r;++n)t[n]=r,r>>>=8},q=function(t,n){var r=n.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=n.level<2?4:9==n.level?2:0,t[9]=3,0!=n.mtime&&j(t,4,Math.floor(new Date(n.mtime||Date.now())/1e3)),r){t[3]=8;for(var e=0;e<=r.length;++e)t[e+10]=r.charCodeAt(e)}},B=function(t){return 10+(t.filename?t.filename.length+1:0)},G=function(){function n(n,r){if("function"==typeof n&&(r=n,n={}),this.ondata=r,this.o=n||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new t(98304),this.o.dictionary){var e=this.o.dictionary.subarray(-32768);this.b.set(e,32768-e.length),this.s.i=32768-e.length}}return n.prototype.p=function(t,n){this.ondata(O(t,this.o,0,0,this.s),n)},n.prototype.push=function(n,r){this.ondata||E(5),this.s.l&&E(4);var e=n.length+this.s.z;if(e>this.b.length){if(e>2*this.b.length-32768){var i=new t(-32768&e);i.set(this.b.subarray(0,this.s.z)),this.b=i}var s=this.b.length-this.s.z;this.b.set(n.subarray(0,s),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(n.subarray(s),32768),this.s.z=n.length-s+32768,this.s.i=32766,this.s.w=32768}else this.b.set(n,this.s.z),this.s.z+=n.length;this.s.l=1&r,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},n.prototype.flush=function(){this.ondata||E(5),this.s.l&&E(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},n}();var H=function(){function t(t,n){this.c=L(),this.v=1,G.call(this,t,n)}return t.prototype.push=function(t,n){this.c.p(t),G.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){var r=O(t,this.o,this.v&&(this.o.dictionary?6:2),n&&4,this.s);this.v&&(function(t,n){var r=n.level,e=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=e<<6|(n.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,n.dictionary){var i=L();i.p(n.dictionary),j(t,2,i.d())}}(r,this.o),this.v=0),n&&j(r,r.length-4,this.c.d()),this.ondata(r,n)},t.prototype.flush=function(){G.prototype.flush.call(this)},t}(),J="undefined"!=typeof TextEncoder&&new TextEncoder,K="undefined"!=typeof TextDecoder&&new TextDecoder;try{K.decode(F,{stream:!0})}catch(t){}var N=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,n){this.ondata||E(5),this.d&&E(4),this.ondata(P(t),this.d=n||!1)},t}();function P(n,r){if(J)return J.encode(n);for(var e=n.length,i=new t(n.length+(n.length>>1)),s=0,a=function(t){i[s++]=t},o=0;o<e;++o){if(s+5>i.length){var h=new t(s+8+(e-o<<1));h.set(i),i=h}var f=n.charCodeAt(o);f<128||r?a(f):f<2048?(a(192|f>>6),a(128|63&f)):f>55295&&f<57344?(a(240|(f=65536+(1047552&f)|1023&n.charCodeAt(++o))>>18),a(128|f>>12&63),a(128|f>>6&63),a(128|63&f)):(a(224|f>>12),a(128|f>>6&63),a(128|63&f))}return b(i,0,s)}function Q(t){return function(t,n){n||(n={});var r=S(),e=t.length;r.p(t);var i=O(t,n,B(n),8),s=i.length;return q(i,n),j(i,s-8,r.d()),j(i,s-4,e),i}(P(t))}const R=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const n=this._hasEvents?",":"";this.stream.push(n+t),this._hasEvents=!0}finish(){this.stream.push("]",!0);const t=function(t){let n=0;for(const r of t)n+=r.length;const r=new Uint8Array(n);for(let n=0,e=0,i=t.length;n<i;n++){const i=t[n];r.set(i,e),e+=i.length}return r}(this._deflatedData);return this._init(),t}_init(){this._hasEvents=!1,this._deflatedData=[],this.deflate=new H,this.deflate.ondata=(t,n)=>{this._deflatedData.push(t)},this.stream=new N(((t,n)=>{this.deflate.push(t,n)})),this.stream.push("[")}},V={clear:()=>{R.clear()},addEvent:t=>R.addEvent(t),finish:()=>R.finish(),compress:t=>Q(t)};addEventListener("message",(function(t){const n=t.data.method,r=t.data.id,e=t.data.arg;if(n in V&&"function"==typeof V[n])try{const t=V[n](e);postMessage({id:r,method:n,success:!0,response:t})}catch(t){postMessage({id:r,method:n,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});';function Vs(){const e=new Blob([qs]);return URL.createObjectURL(e)}const Ks=["info","warn","error","log"];const Js="[Replay] ";function Gs(e,t="info"){o({category:"console",data:{logger:"replay"},level:t,message:`${Js}${e}`},{level:t})}function Ys(){let e=false;let t=false;const n={exception:()=>{},infoTick:()=>{},setConfig:n=>{e=!!n.captureExceptions;t=!!n.traceInternals}};if($s){Ks.forEach((e=>{n[e]=(...n)=>{i[e](Js,...n);t&&Gs(n.join(""),a(e))}}));n.exception=(s,...r)=>{r.length&&n.error&&n.error(...r);i.error(Js,s);e?c(s):t&&Gs(s,"error")};n.infoTick=(...e)=>{i.info(Js,...e);t&&setTimeout((()=>Gs(e[0])),0)}}else Ks.forEach((e=>{n[e]=()=>{}}));return n}const Xs=Ys();class EventBufferSizeExceededError extends Error{constructor(){super(`Event buffer exceeded maximum size of ${ie}.`)}}class EventBufferArray{constructor(){this.events=[];this._totalSize=0;this.hasCheckout=false;this.waitForCheckout=false}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(e){const t=JSON.stringify(e).length;this._totalSize+=t;if(this._totalSize>ie)throw new EventBufferSizeExceededError;this.events.push(e)}finish(){return new Promise((e=>{const t=this.events;this.clear();e(JSON.stringify(t))}))}clear(){this.events=[];this._totalSize=0;this.hasCheckout=false}getEarliestTimestamp(){const e=this.events.map((e=>e.timestamp)).sort()[0];return e?Xn(e):null}}class WorkerHandler{constructor(e){this._worker=e;this._id=0}ensureReady(){if(this._ensureReadyPromise)return this._ensureReadyPromise;this._ensureReadyPromise=new Promise(((e,t)=>{this._worker.addEventListener("message",(({data:n})=>{n.success?e():t()}),{once:true});this._worker.addEventListener("error",(e=>{t(e)}),{once:true})}));return this._ensureReadyPromise}destroy(){$s&&Xs.info("Destroying compression worker");this._worker.terminate()}postMessage(e,t){const n=this._getAndIncrementId();return new Promise(((s,r)=>{const o=({data:t})=>{const i=t;if(i.method===e&&i.id===n){this._worker.removeEventListener("message",o);if(i.success)s(i.response);else{$s&&Xs.error("Error in compression worker: ",i.response);r(new Error("Error in compression worker"))}}};this._worker.addEventListener("message",o);this._worker.postMessage({id:n,method:e,arg:t})}))}_getAndIncrementId(){return this._id++}}class EventBufferCompressionWorker{constructor(e){this._worker=new WorkerHandler(e);this._earliestTimestamp=null;this._totalSize=0;this.hasCheckout=false;this.waitForCheckout=false}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(e){const t=Xn(e.timestamp);(!this._earliestTimestamp||t<this._earliestTimestamp)&&(this._earliestTimestamp=t);const n=JSON.stringify(e);this._totalSize+=n.length;return this._totalSize>ie?Promise.reject(new EventBufferSizeExceededError):this._sendEventToWorker(n)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null;this._totalSize=0;this.hasCheckout=false;this._worker.postMessage("clear").then(null,(e=>{$s&&Xs.exception(e,'Sending "clear" message to worker failed',e)}))}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(e){return this._worker.postMessage("addEvent",e)}async _finishRequest(){const e=await this._worker.postMessage("finish");this._earliestTimestamp=null;this._totalSize=0;return e}}class EventBufferProxy{constructor(e){this._fallback=new EventBufferArray;this._compression=new EventBufferCompressionWorker(e);this._used=this._fallback;this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get waitForCheckout(){return this._used.waitForCheckout}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(e){this._used.hasCheckout=e}set waitForCheckout(e){this._used.waitForCheckout=e}destroy(){this._fallback.destroy();this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(e){return this._used.addEvent(e)}async finish(){await this.ensureWorkerIsLoaded();return this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch(e){$s&&Xs.exception(e,"Failed to load the compression worker, falling back to simple buffer");return}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){const{events:e,hasCheckout:t,waitForCheckout:n}=this._fallback;const s=[];for(const t of e)s.push(this._compression.addEvent(t));this._compression.hasCheckout=t;this._compression.waitForCheckout=n;this._used=this._compression;try{await Promise.all(s);this._fallback.clear()}catch(e){$s&&Xs.exception(e,"Failed to add events when switching buffers.")}}}function Qs({useCompression:e,workerUrl:t}){if(e&&window.Worker){const e=Zs(t);if(e)return e}$s&&Xs.info("Using simple buffer");return new EventBufferArray}function Zs(e){try{const t=e||er();if(!t)return;$s&&Xs.info("Using compression worker"+(e?` from ${e}`:""));const n=new Worker(t);return new EventBufferProxy(n)}catch(e){$s&&Xs.exception(e,"Failed to create compression worker")}}function er(){return typeof __SENTRY_EXCLUDE_REPLAY_WORKER__!=="undefined"&&__SENTRY_EXCLUDE_REPLAY_WORKER__?"":Vs()}function tr(){try{return"sessionStorage"in q&&!!q.sessionStorage}catch{return false}}function nr(e){sr();e.session=void 0}function sr(){if(tr())try{q.sessionStorage.removeItem(V)}catch{}}function rr(e){return e!==void 0&&Math.random()<e}function or(e){if(tr())try{q.sessionStorage.setItem(V,JSON.stringify(e))}catch{}}function ir(e){const t=Date.now();const n=e.id||l();const s=e.started||t;const r=e.lastActivity||t;const o=e.segmentId||0;const i=e.sampled;const a=e.previousSessionId;return{id:n,started:s,lastActivity:r,segmentId:o,sampled:i,previousSessionId:a}}function ar(e,t){return rr(e)?"session":!!t&&"buffer"}function cr({sessionSampleRate:e,allowBuffering:t,stickySession:n=false},{previousSessionId:s}={}){const r=ar(e,t);const o=ir({sampled:r,previousSessionId:s});n&&or(o);return o}function lr(){if(!tr())return null;try{const e=q.sessionStorage.getItem(V);if(!e)return null;const t=JSON.parse(e);$s&&Xs.infoTick("Loading existing session");return ir(t)}catch{return null}}function ur(e,t,n=+new Date){return e===null||t===void 0||t<0||t!==0&&e+t<=n}function dr(e,{maxReplayDuration:t,sessionIdleExpire:n,targetTime:s=Date.now()}){return ur(e.started,t,s)||ur(e.lastActivity,n,s)}function hr(e,{sessionIdleExpire:t,maxReplayDuration:n}){return!!dr(e,{sessionIdleExpire:t,maxReplayDuration:n})&&(e.sampled!=="buffer"||e.segmentId!==0)}function pr({sessionIdleExpire:e,maxReplayDuration:t,previousSessionId:n},s){const r=s.stickySession&&lr();if(!r){$s&&Xs.infoTick("Creating new session");return cr(s,{previousSessionId:n})}if(!hr(r,{sessionIdleExpire:e,maxReplayDuration:t}))return r;$s&&Xs.infoTick("Session in sessionStorage is expired, creating new one...");return cr(s,{previousSessionId:r.id})}function fr(e){return e.type===Qt.Custom}function mr(e,t,n){if(!Sr(e,t))return false;gr(e,t,n);return true}function yr(e,t,n){return Sr(e,t)?gr(e,t,n):Promise.resolve(null)}async function gr(e,t,n){const{eventBuffer:s}=e;if(!s||s.waitForCheckout&&!n)return null;const r=e.recordingMode==="buffer";try{n&&r&&s.clear();if(n){s.hasCheckout=true;s.waitForCheckout=false}const o=e.getOptions();const i=kr(t,o.beforeAddRecordingEvent);if(!i)return;return await s.addEvent(i)}catch(t){const n=t&&t instanceof EventBufferSizeExceededError;const o=n?"addEventSizeExceeded":"addEvent";if(n&&r){s.clear();s.waitForCheckout=true;return null}e.handleException(t);await e.stop({reason:o});const i=u();i&&i.recordDroppedEvent("internal_sdk_error","replay")}}function Sr(e,t){if(!e.eventBuffer||e.isPaused()||!e.isEnabled())return false;const n=Xn(t.timestamp);if(n+e.timeouts.sessionIdlePause<Date.now())return false;if(n>e.getContext().initialTimestamp+e.getOptions().maxReplayDuration){$s&&Xs.infoTick(`Skipping event with timestamp ${n} because it is after maxReplayDuration`);return false}return true}function kr(e,t){try{if(typeof t==="function"&&fr(e))return t(e)}catch(e){$s&&Xs.exception(e,"An error occurred in the `beforeAddRecordingEvent` callback, skipping the event...");return null}return e}function vr(e){return!e.type}function br(e){return e.type==="transaction"}function wr(e){return e.type==="replay_event"}function _r(e){return e.type==="feedback"}function Ir(e){return(t,n)=>{if(!e.isEnabled()||!vr(t)&&!br(t))return;const s=n?.statusCode;!s||s<200||s>=300||(br(t)?Cr(e,t):Er(e,t))}}function Cr(e,t){const n=e.getContext();t.contexts?.trace?.trace_id&&n.traceIds.size<100&&n.traceIds.add(t.contexts.trace.trace_id)}function Er(e,t){const n=e.getContext();t.event_id&&n.errorIds.size<100&&n.errorIds.add(t.event_id);if(e.recordingMode!=="buffer"||!t.tags||!t.tags.replayId)return;const{beforeErrorSampling:s}=e.getOptions();(typeof s!=="function"||s(t))&&D((async()=>{try{await e.sendBufferedReplayOrFlush()}catch(t){e.handleException(t)}}))}function Mr(e){return t=>{e.isEnabled()&&vr(t)&&xr(e,t)}}function xr(e,t){const n=t.exception?.values?.[0]?.value;if(typeof n==="string"&&(n.match(/(reactjs\.org\/docs\/error-decoder\.html\?invariant=|react\.dev\/errors\/)(418|419|422|423|425)/)||n.match(/(does not match server-rendered HTML|Hydration failed because)/i))){const t=gs({category:"replay.hydrate-error",data:{url:d()}});Zn(e,t)}}function Tr(e){const t=u();t&&t.on("beforeAddBreadcrumb",(t=>Rr(e,t)))}function Rr(e,t){if(!e.isEnabled()||!Dr(t))return;const n=Or(t);n&&Zn(e,n)}function Or(e){return!Dr(e)||["fetch","xhr","sentry.event","sentry.transaction"].includes(e.category)||e.category.startsWith("ui.")?null:e.category==="console"?Ar(e):gs(e)}function Ar(e){const n=e.data?.arguments;if(!Array.isArray(n)||n.length===0)return gs(e);let s=false;const r=n.map((e=>{if(!e)return e;if(typeof e==="string"){if(e.length>se){s=true;return`${e.slice(0,se)}…`}return e}if(typeof e==="object")try{const n=t(e,7);const r=JSON.stringify(n);if(r.length>se){s=true;return`${JSON.stringify(n,null,2).slice(0,se)}…`}return n}catch{}return e}));return gs({...e,data:{...e.data,arguments:r,...s?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}function Dr(e){return!!e.category}function Nr(e,t){return!(e.type||!e.exception||!e.exception.values||!e.exception.values.length)&&!!t.originalException?.__rrweb__}function Lr(){const e=h().getPropagationContext().dsc;e&&delete e.replay_id;const t=p();if(t){const e=f(t);delete e.replay_id}}function Fr(e,t){e.triggerUserActivity();e.addUpdate((()=>{if(!t.timestamp)return true;e.throttledAddEvent({type:Qt.Custom,timestamp:t.timestamp*1e3,data:{tag:"breadcrumb",payload:{timestamp:t.timestamp,type:"default",category:"sentry.feedback",data:{feedbackId:t.event_id}}}});return false}))}function Pr(e,t){return e.recordingMode==="buffer"&&(t.message!==J&&(!(!t.exception||t.type)&&rr(e.getOptions().errorSampleRate)))}function Br(e){return Object.assign(((t,n)=>{if(!e.isEnabled()||e.isPaused())return t;if(wr(t)){delete t.breadcrumbs;return t}if(!vr(t)&&!br(t)&&!_r(t))return t;const s=e.checkAndHandleExpiredSession();if(!s){Lr();return t}if(_r(t)){e.flush();t.contexts.feedback.replay_id=e.getSessionId();Fr(e,t);return t}if(Nr(t,n)&&!e.getOptions()._experiments.captureExceptions){$s&&Xs.log("Ignoring error from rrweb internals",t);return null}const r=Pr(e,t);const o=r||e.recordingMode==="session";o&&(t.tags={...t.tags,replayId:e.getSessionId()});return t}),{id:"Replay"})}function zr(e,t){return t.map((({type:t,start:n,end:s,name:r,data:o})=>{const i=e.throttledAddEvent({type:Qt.Custom,timestamp:n,data:{tag:"performanceSpan",payload:{op:t,description:r,startTimestamp:n,endTimestamp:s,data:o}}});return typeof i==="string"?Promise.resolve(null):i}))}function Ur(e){const{from:t,to:n}=e;const s=Date.now()/1e3;return{type:"navigation.push",start:s,end:s,name:n,data:{previous:t}}}function Wr(e){return t=>{if(!e.isEnabled())return;const n=Ur(t);if(n!==null){e.getContext().urls.push(n.name);e.triggerUserActivity();e.addUpdate((()=>{zr(e,[n]);return false}))}}}function Hr(e,t){return(!$s||!e.getOptions()._experiments.traceInternals)&&m(t,u())}function jr(e,t){e.isEnabled()&&t!==null&&(Hr(e,t.name)||e.addUpdate((()=>{zr(e,[t]);return true})))}function $r(e){if(!e)return;const t=new TextEncoder;try{if(typeof e==="string")return t.encode(e).length;if(e instanceof URLSearchParams)return t.encode(e.toString()).length;if(e instanceof FormData){const n=z(e);return t.encode(n).length}if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength}catch{}}function qr(e){if(!e)return;const t=parseInt(e,10);return isNaN(t)?void 0:t}function Vr(e,t){if(!e)return{headers:{},size:void 0,_meta:{warnings:[t]}};const n={...e._meta};const s=n.warnings||[];n.warnings=[...s,t];e._meta=n;return e}function Kr(e,t){if(!t)return null;const{startTimestamp:n,endTimestamp:s,url:r,method:o,statusCode:i,request:a,response:c}=t;const l={type:e,start:n/1e3,end:s/1e3,name:r,data:{method:o,statusCode:i,request:a,response:c}};return l}function Jr(e){return{headers:{},size:e,_meta:{warnings:["URL_SKIPPED"]}}}function Gr(e,t,n){if(!t&&Object.keys(e).length===0)return;if(!t)return{headers:e};if(!n)return{headers:e,size:t};const s={headers:e,size:t};const{body:r,warnings:o}=Xr(n);s.body=r;o?.length&&(s._meta={warnings:o});return s}function Yr(e,t){return Object.entries(e).reduce(((n,[s,r])=>{const o=s.toLowerCase();t.includes(o)&&e[s]&&(n[o]=r);return n}),{})}function Xr(e){if(!e||typeof e!=="string")return{body:e};const t=e.length>ne;const n=Qr(e);if(t){const t=e.slice(0,ne);return n?{body:t,warnings:["MAYBE_JSON_TRUNCATED"]}:{body:`${t}…`,warnings:["TEXT_TRUNCATED"]}}if(n)try{const t=JSON.parse(e);return{body:t}}catch{}return{body:e}}function Qr(e){const t=e[0];const n=e[e.length-1];return t==="["&&n==="]"||t==="{"&&n==="}"}function Zr(e,t){const n=eo(e);return y(n,t)}function eo(e,t=q.document.baseURI){if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith(q.location.origin))return e;const n=new URL(e,t);if(n.origin!==new URL(t).origin)return e;const s=n.href;return!e.endsWith("/")&&s.endsWith("/")?s.slice(0,-1):s}async function to(e,t,n){try{const s=await so(e,t,n);const r=Kr("resource.fetch",s);jr(n.replay,r)}catch(e){$s&&Xs.exception(e,"Failed to capture fetch breadcrumb")}}function no(e,t){const{input:n,response:s}=t;const r=n?U(n):void 0;const o=$r(r);const i=s?qr(s.headers.get("content-length")):void 0;o!==void 0&&(e.data.request_body_size=o);i!==void 0&&(e.data.response_body_size=i)}async function so(e,t,n){const s=Date.now();const{startTimestamp:r=s,endTimestamp:o=s}=t;const{url:i,method:a,status_code:c=0,request_body_size:l,response_body_size:u}=e.data;const d=Zr(i,n.networkDetailAllowUrls)&&!Zr(i,n.networkDetailDenyUrls);const h=d?ro(n,t.input,l):Jr(l);const p=await oo(d,n,t.response,u);return{startTimestamp:r,endTimestamp:o,url:i,method:a,statusCode:c,request:h,response:p}}function ro({networkCaptureBodies:e,networkRequestHeaders:t},n,s){const r=n?lo(n,t):{};if(!e)return Gr(r,s,void 0);const o=U(n);const[i,a]=W(o,Xs);const c=Gr(r,s,i);return a?Vr(c,a):c}async function oo(e,{networkCaptureBodies:t,networkResponseHeaders:n},s,r){if(!e&&r!==void 0)return Jr(r);const o=s?co(s.headers,n):{};if(!s||!t&&r!==void 0)return Gr(o,r,void 0);const[i,a]=await ao(s);const c=io(i,{networkCaptureBodies:t,responseBodySize:r,captureDetails:e,headers:o});return a?Vr(c,a):c}function io(e,{networkCaptureBodies:t,responseBodySize:n,captureDetails:s,headers:r}){try{const o=e?.length&&n===void 0?$r(e):n;return s?Gr(r,o,t?e:void 0):Jr(o)}catch(e){$s&&Xs.exception(e,"Failed to serialize response body");return Gr(r,n,void 0)}}async function ao(e){const t=ho(e);if(!t)return[void 0,"BODY_PARSE_ERROR"];try{const e=await po(t);return[e]}catch(e){if(e instanceof Error&&e.message.indexOf("Timeout")>-1){$s&&Xs.warn("Parsing text body from response timed out");return[void 0,"BODY_PARSE_TIMEOUT"]}$s&&Xs.exception(e,"Failed to get text body from response");return[void 0,"BODY_PARSE_ERROR"]}}function co(e,t){const n={};t.forEach((t=>{e.get(t)&&(n[t]=e.get(t))}));return n}function lo(e,t){return e.length===1&&typeof e[0]!=="string"?uo(e[0],t):e.length===2?uo(e[1],t):{}}function uo(e,t){if(!e)return{};const n=e.headers;return n?n instanceof Headers?co(n,t):Array.isArray(n)?{}:Yr(n,t):{}}function ho(e){try{return e.clone()}catch(e){$s&&Xs.exception(e,"Failed to clone response body")}}function po(e){return new Promise(((t,n)=>{const s=D((()=>n(new Error("Timeout while trying to read response body"))),500);fo(e).then((e=>t(e)),(e=>n(e))).finally((()=>clearTimeout(s)))}))}async function fo(e){return await e.text()}async function mo(e,t,n){try{const s=go(e,t,n);const r=Kr("resource.xhr",s);jr(n.replay,r)}catch(e){$s&&Xs.exception(e,"Failed to capture xhr breadcrumb")}}function yo(e,t){const{xhr:n,input:s}=t;if(!n)return;const r=$r(s);const o=n.getResponseHeader("content-length")?qr(n.getResponseHeader("content-length")):bo(n.response,n.responseType);r!==void 0&&(e.data.request_body_size=r);o!==void 0&&(e.data.response_body_size=o)}function go(e,t,n){const s=Date.now();const{startTimestamp:r=s,endTimestamp:o=s,input:i,xhr:a}=t;const{url:c,method:l,status_code:u=0,request_body_size:d,response_body_size:h}=e.data;if(!c)return null;if(!a||!Zr(c,n.networkDetailAllowUrls)||Zr(c,n.networkDetailDenyUrls)){const e=Jr(d);const t=Jr(h);return{startTimestamp:r,endTimestamp:o,url:c,method:l,statusCode:u,request:e,response:t}}const p=a[H];const f=p?Yr(p.request_headers,n.networkRequestHeaders):{};const m=Yr(So(a),n.networkResponseHeaders);const[y,g]=n.networkCaptureBodies?W(i,Xs):[void 0];const[S,k]=n.networkCaptureBodies?ko(a):[void 0];const v=Gr(f,d,y);const b=Gr(m,h,S);return{startTimestamp:r,endTimestamp:o,url:c,method:l,statusCode:u,request:g?Vr(v,g):v,response:k?Vr(b,k):b}}function So(e){const t=e.getAllResponseHeaders();return t?t.split("\r\n").reduce(((e,t)=>{const[n,s]=t.split(": ");s&&(e[n.toLowerCase()]=s);return e}),{}):{}}function ko(e){const t=[];try{return[e.responseText]}catch(e){t.push(e)}try{return vo(e.response,e.responseType)}catch(e){t.push(e)}$s&&Xs.warn("Failed to get xhr response body",...t);return[void 0]}function vo(e,t){try{if(typeof e==="string")return[e];if(e instanceof Document)return[e.body.outerHTML];if(t==="json"&&e&&typeof e==="object")return[JSON.stringify(e)];if(!e)return[void 0]}catch(t){$s&&Xs.exception(t,"Failed to serialize body",e);return[void 0,"BODY_PARSE_ERROR"]}$s&&Xs.info("Skipping network body because of body type",e);return[void 0,"UNPARSEABLE_BODY_TYPE"]}function bo(e,t){try{const n=t==="json"&&e&&typeof e==="object"?JSON.stringify(e):e;return $r(n)}catch{return}}function wo(e){const t=u();try{const{networkDetailAllowUrls:n,networkDetailDenyUrls:s,networkCaptureBodies:r,networkRequestHeaders:o,networkResponseHeaders:i}=e.getOptions();const a={replay:e,networkDetailAllowUrls:n,networkDetailDenyUrls:s,networkCaptureBodies:r,networkRequestHeaders:o,networkResponseHeaders:i};t&&t.on("beforeAddBreadcrumb",((e,t)=>_o(a,e,t)))}catch{}}function _o(e,t,n){if(t.data)try{if(Io(t)&&Eo(n)){yo(t,n);mo(t,n,e)}if(Co(t)&&Mo(n)){no(t,n);to(t,n,e)}}catch(e){$s&&Xs.exception(e,"Error when enriching network breadcrumb")}}function Io(e){return e.category==="xhr"}function Co(e){return e.category==="fetch"}function Eo(e){return e?.xhr}function Mo(e){return e?.response}function xo(e,{autoFlushOnFeedback:t}){const n=u();j(bs(e));$(Wr(e));Tr(e);wo(e);const s=Br(e);g(s);if(n){n.on("beforeSendEvent",Mr(e));n.on("afterSendEvent",Ir(e));n.on("createDsc",(t=>{const n=e.getSessionId();if(n&&e.isEnabled()&&e.recordingMode==="session"){const s=e.checkAndHandleExpiredSession();s&&(t.replay_id=n)}}));n.on("spanStart",(t=>{e.lastActiveSpan=t}));n.on("spanEnd",(t=>{e.lastActiveSpan=t}));n.on("beforeSendFeedback",(async(n,s)=>{const r=e.getSessionId();if(s?.includeReplay&&e.isEnabled()&&r&&n.contexts?.feedback){n.contexts.feedback.source==="api"&&t&&await e.flush();n.contexts.feedback.replay_id=r}}));t&&n.on("openFeedbackWidget",(async()=>{await e.flush()}))}}async function To(e){try{return Promise.all(zr(e,[Ro(q.performance.memory)]))}catch(e){return[]}}function Ro(e){const{jsHeapSizeLimit:t,totalJSHeapSize:n,usedJSHeapSize:s}=e;const r=Date.now()/1e3;return{type:"memory",name:"memory",start:r,end:r,data:{memory:{jsHeapSizeLimit:t,totalJSHeapSize:n,usedJSHeapSize:s}}}}
/**
 * Heavily simplified debounce function based on lodash.debounce.
 *
 * This function takes a callback function (@param fun) and delays its invocation
 * by @param wait milliseconds. Optionally, a maxWait can be specified in @param options,
 * which ensures that the callback is invoked at least once after the specified max. wait time.
 *
 * @param func the function whose invocation is to be debounced
 * @param wait the minimum time until the function is invoked after it was called once
 * @param options the options object, which can contain the `maxWait` property
 *
 * @returns the debounced version of the function, which needs to be called at least once to start the
 *          debouncing process. Subsequent calls will reset the debouncing timer and, in case @paramfunc
 *          was already invoked in the meantime, return @param func's return value.
 *          The debounced function has two additional properties:
 *          - `flush`: Invokes the debounced function immediately and returns its return value
 *          - `cancel`: Cancels the debouncing process and resets the debouncing timer
 */function Oo(e,t,n){let s;let r;let o;const i=n?.maxWait?Math.max(n.maxWait,t):0;function a(){c();s=e();return s}function c(){r!==void 0&&clearTimeout(r);o!==void 0&&clearTimeout(o);r=o=void 0}function l(){return r!==void 0||o!==void 0?a():s}function u(){r&&clearTimeout(r);r=D(a,t);i&&o===void 0&&(o=D(a,i));return s}u.cancel=c;u.flush=l;return u}const Ao=e.navigator;function Do(){return/iPhone|iPad|iPod/i.test(Ao?.userAgent??"")||/Macintosh/i.test(Ao?.userAgent??"")&&Ao?.maxTouchPoints&&Ao?.maxTouchPoints>1?{sampling:{mousemove:false}}:{}}function No(e){let t=false;return(n,s)=>{if(!e.checkAndHandleExpiredSession()){$s&&Xs.warn("Received replay event after session expired.");return}const r=s||!t;t=true;e.clickDetector&&fs(e.clickDetector,n);e.addUpdate((()=>{e.recordingMode==="buffer"&&r&&e.setInitialState();if(!mr(e,n,r))return true;if(!r)return false;const t=e.session;Fo(e,r);if(e.recordingMode==="buffer"&&t&&e.eventBuffer){const n=e.eventBuffer.getEarliestTimestamp();if(n){$s&&Xs.info(`Updating session start time to earliest event in buffer to ${new Date(n)}`);t.started=n;e.getOptions().stickySession&&or(t)}}if(t?.previousSessionId)return true;e.recordingMode==="session"&&void e.flush();return true}))}}function Lo(e){const t=e.getOptions();return{type:Qt.Custom,timestamp:Date.now(),data:{tag:"options",payload:{shouldRecordCanvas:e.isRecordingCanvas(),sessionSampleRate:t.sessionSampleRate,errorSampleRate:t.errorSampleRate,useCompressionOption:t.useCompression,blockAllMedia:t.blockAllMedia,maskAllText:t.maskAllText,maskAllInputs:t.maskAllInputs,useCompression:!!e.eventBuffer&&e.eventBuffer.type==="worker",networkDetailHasUrls:t.networkDetailAllowUrls.length>0,networkCaptureBodies:t.networkCaptureBodies,networkRequestHasHeaders:t.networkRequestHeaders.length>0,networkResponseHasHeaders:t.networkResponseHeaders.length>0}}}}function Fo(e,t){t&&e.session&&e.session.segmentId===0&&mr(e,Lo(e),false)}function Po(e,t,n,s){return S(k(e,v(e),s,n),[[{type:"replay_event"},e],[{type:"replay_recording",length:typeof t==="string"?(new TextEncoder).encode(t).length:t.length},t]])}function Bo({recordingData:e,headers:t}){let n;const s=`${JSON.stringify(t)}\n`;if(typeof e==="string")n=`${s}${e}`;else{const t=new TextEncoder;const r=t.encode(s);n=new Uint8Array(r.length+e.length);n.set(r);n.set(e,r.length)}return n}async function zo({client:e,scope:t,replayId:n,event:s}){const r=typeof e._integrations!=="object"||e._integrations===null||Array.isArray(e._integrations)?void 0:Object.keys(e._integrations);const o={event_id:n,integrations:r};e.emit("preprocessEvent",s,o);const i=await b(e.getOptions(),s,o,t,e,w());if(!i)return null;e.emit("postprocessEvent",i,o);i.platform=i.platform||"javascript";const a=e.getSdkMetadata();const{name:c,version:l}=a?.sdk||{};i.sdk={...i.sdk,name:c||"sentry.javascript.unknown",version:l||"0.0.0"};return i}async function Uo({recordingData:e,replayId:t,segmentId:n,eventContext:s,timestamp:r,session:o}){const i=Bo({recordingData:e,headers:{segment_id:n}});const{urls:a,errorIds:c,traceIds:l,initialTimestamp:d}=s;const p=u();const f=h();const m=p?.getTransport();const y=p?.getDsn();if(!p||!m||!y||!o.sampled)return _({});const g={type:K,replay_start_timestamp:d/1e3,timestamp:r/1e3,error_ids:c,trace_ids:l,urls:a,replay_id:t,segment_id:n,replay_type:o.sampled};const S=await zo({scope:f,client:p,replayId:t,event:g});if(!S){p.recordDroppedEvent("event_processor","replay");$s&&Xs.info("An event processor returned `null`, will not send event.");return _({})}delete S.sdkProcessingMetadata;const k=Po(S,i,y,p.getOptions().tunnel);let v;try{v=await m.send(k)}catch(e){const t=new Error(J);try{t.cause=e}catch{}throw t}if(typeof v.statusCode==="number"&&(v.statusCode<200||v.statusCode>=300))throw new TransportStatusCodeError(v.statusCode);const b=I({},v);if(C(b,"replay"))throw new RateLimitError(b);return v}class TransportStatusCodeError extends Error{constructor(e){super(`Transport returned status code ${e}`)}}class RateLimitError extends Error{constructor(e){super("Rate limit hit");this.rateLimits=e}}async function Wo(e,t={count:0,interval:ee}){const{recordingData:n,onError:s}=e;if(n.length)try{await Uo(e);return true}catch(n){if(n instanceof TransportStatusCodeError||n instanceof RateLimitError)throw n;E("Replays",{_retryCount:t.count});s&&s(n);if(t.count>=te){const e=new Error(`${J} - max retries exceeded`);try{e.cause=n}catch{}throw e}t.interval*=++t.count;return new Promise(((n,s)=>{D((async()=>{try{await Wo(e,t);n(true)}catch(e){s(e)}}),t.interval)}))}}const Ho="__THROTTLED";const jo="__SKIPPED";function $o(e,t,n){const s=new Map;const r=e=>{const t=e-n;s.forEach(((e,n)=>{n<t&&s.delete(n)}))};const o=()=>[...s.values()].reduce(((e,t)=>e+t),0);let i=false;return(...n)=>{const a=Math.floor(Date.now()/1e3);r(a);if(o()>=t){const e=i;i=true;return e?jo:Ho}i=false;const c=s.get(a)||0;s.set(a,c+1);return e(...n)}}class ReplayContainer{constructor({options:e,recordingOptions:t}){this.eventBuffer=null;this.performanceEntries=[];this.replayPerformanceEntries=[];this.recordingMode="session";this.timeouts={sessionIdlePause:G,sessionIdleExpire:Y};this._lastActivity=Date.now();this._isEnabled=false;this._isPaused=false;this._requiresManualStart=false;this._hasInitializedCoreListeners=false;this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""};this._recordingOptions=t;this._options=e;this._debouncedFlush=Oo((()=>this._flush()),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay});this._throttledAddEvent=$o(((e,t)=>yr(this,e,t)),300,5);const{slowClickTimeout:n,slowClickIgnoreSelectors:s}=this.getOptions();const r=n?{threshold:Math.min(re,n),timeout:n,scrollTimeout:oe,ignoreSelector:s?s.join(","):""}:void 0;r&&(this.clickDetector=new ClickDetector(this,r));if($s){const t=e._experiments;Xs.setConfig({captureExceptions:!!t.captureExceptions,traceInternals:!!t.traceInternals})}this._handleVisibilityChange=()=>{q.document.visibilityState==="visible"?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()};this._handleWindowBlur=()=>{const e=gs({category:"ui.blur"});this._doChangeToBackgroundTasks(e)};this._handleWindowFocus=()=>{const e=gs({category:"ui.focus"});this._doChangeToForegroundTasks(e)};this._handleKeyboardEvent=e=>{Es(this,e)}}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}isRecordingCanvas(){return Boolean(this._canvas)}getOptions(){return this._options}handleException(e){$s&&Xs.exception(e);this._options.onError&&this._options.onError(e)}initializeSampling(e){const{errorSampleRate:t,sessionSampleRate:n}=this._options;const s=t<=0&&n<=0;this._requiresManualStart=s;if(!s){this._initializeSessionForSampling(e);if(this.session){if(this.session.sampled!==false){this.recordingMode=this.session.sampled==="buffer"&&this.session.segmentId===0?"buffer":"session";$s&&Xs.infoTick(`Starting replay in ${this.recordingMode} mode`);this._initializeRecording()}}else $s&&Xs.exception(new Error("Unable to initialize and create session"))}}start(){if(this._isEnabled&&this.recordingMode==="session"){$s&&Xs.info("Recording is already in progress");return}if(this._isEnabled&&this.recordingMode==="buffer"){$s&&Xs.info("Buffering is in progress, call `flush()` to save the replay");return}$s&&Xs.infoTick("Starting replay in session mode");this._updateUserActivity();const e=pr({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:false});this.session=e;this._initializeRecording()}startBuffering(){if(this._isEnabled){$s&&Xs.info("Buffering is in progress, call `flush()` to save the replay");return}$s&&Xs.infoTick("Starting replay in buffer mode");const e=pr({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:true});this.session=e;this.recordingMode="buffer";this._initializeRecording()}startRecording(){try{const e=this._canvas;this._stopRecording=qn({...this._recordingOptions,...this.recordingMode==="buffer"?{checkoutEveryNms:Z}:this._options._experiments.continuousCheckout&&{checkoutEveryNms:Math.max(36e4,this._options._experiments.continuousCheckout)},emit:No(this),...Do(),onMutation:this._onMutationHandler.bind(this),...e?{recordCanvas:e.recordCanvas,getCanvasManager:e.getCanvasManager,sampling:e.sampling,dataURLOptions:e.dataURLOptions}:{}})}catch(e){this.handleException(e)}}stopRecording(){try{if(this._stopRecording){this._stopRecording();this._stopRecording=void 0}return true}catch(e){this.handleException(e);return false}}async stop({forceFlush:e=false,reason:t}={}){if(this._isEnabled){this._isEnabled=false;try{$s&&Xs.info("Stopping Replay"+(t?` triggered by ${t}`:""));Lr();this._removeListeners();this.stopRecording();this._debouncedFlush.cancel();e&&await this._flush({force:true});this.eventBuffer?.destroy();this.eventBuffer=null;nr(this)}catch(e){this.handleException(e)}}}pause(){if(!this._isPaused){this._isPaused=true;this.stopRecording();$s&&Xs.info("Pausing replay")}}resume(){if(this._isPaused&&this._checkSession()){this._isPaused=false;this.startRecording();$s&&Xs.info("Resuming replay")}}async sendBufferedReplayOrFlush({continueRecording:e=true}={}){if(this.recordingMode==="session")return this.flushImmediate();const t=Date.now();$s&&Xs.info("Converting buffer to session");await this.flushImmediate();const n=this.stopRecording();if(e&&n&&this.recordingMode!=="session"){this.recordingMode="session";if(this.session){this._updateUserActivity(t);this._updateSessionActivity(t);this._maybeSaveSession()}this.startRecording()}}addUpdate(e){const t=e();this.recordingMode!=="buffer"&&t!==true&&this._debouncedFlush()}triggerUserActivity(){this._updateUserActivity();if(this._stopRecording){this.checkAndHandleExpiredSession();this._updateSessionActivity()}else{if(!this._checkSession())return;this.resume()}}updateUserActivity(){this._updateUserActivity();this._updateSessionActivity()}conditionalFlush(){return this.recordingMode==="buffer"?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){this._debouncedFlush();return this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session?.id}checkAndHandleExpiredSession(){if(!(this._lastActivity&&ur(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&this.session.sampled==="session"))return!!this._checkSession();this.pause()}setInitialState(){const e=`${q.location.pathname}${q.location.hash}${q.location.search}`;const t=`${q.location.origin}${e}`;this.performanceEntries=[];this.replayPerformanceEntries=[];this._clearContext();this._context.initialUrl=t;this._context.initialTimestamp=Date.now();this._context.urls.push(t)}throttledAddEvent(e,t){const n=this._throttledAddEvent(e,t);if(n===Ho){const e=gs({category:"replay.throttled"});this.addUpdate((()=>!mr(this,{type:Yn,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e,metric:true}})))}return n}getCurrentRoute(){const e=this.lastActiveSpan||p();const t=e&&M(e);const n=t&&x(t).data||{};const s=n[T];if(t&&s&&["route","custom"].includes(s))return x(t).description}_initializeRecording(){this.setInitialState();this._updateSessionActivity();this.eventBuffer=Qs({useCompression:this._options.useCompression,workerUrl:this._options.workerUrl});this._removeListeners();this._addListeners();this._isEnabled=true;this._isPaused=false;this.startRecording()}_initializeSessionForSampling(e){const t=this._options.errorSampleRate>0;const n=pr({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,previousSessionId:e},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:t});this.session=n}_checkSession(){if(!this.session)return false;const e=this.session;if(hr(e,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})){this._refreshSession(e);return false}return true}async _refreshSession(e){if(this._isEnabled){await this.stop({reason:"refresh session"});this.initializeSampling(e.id)}}_addListeners(){try{q.document.addEventListener("visibilitychange",this._handleVisibilityChange);q.addEventListener("blur",this._handleWindowBlur);q.addEventListener("focus",this._handleWindowFocus);q.addEventListener("keydown",this._handleKeyboardEvent);this.clickDetector&&this.clickDetector.addListeners();if(!this._hasInitializedCoreListeners){xo(this,{autoFlushOnFeedback:this._options._experiments.autoFlushOnFeedback});this._hasInitializedCoreListeners=true}}catch(e){this.handleException(e)}this._performanceCleanupCallback=js(this)}_removeListeners(){try{q.document.removeEventListener("visibilitychange",this._handleVisibilityChange);q.removeEventListener("blur",this._handleWindowBlur);q.removeEventListener("focus",this._handleWindowFocus);q.removeEventListener("keydown",this._handleKeyboardEvent);this.clickDetector&&this.clickDetector.removeListeners();this._performanceCleanupCallback&&this._performanceCleanupCallback()}catch(e){this.handleException(e)}}_doChangeToBackgroundTasks(e){if(!this.session)return;const t=dr(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire});if(!t){e&&this._createCustomBreadcrumb(e);void this.conditionalFlush()}}_doChangeToForegroundTasks(e){if(!this.session)return;const t=this.checkAndHandleExpiredSession();t?e&&this._createCustomBreadcrumb(e):$s&&Xs.info("Document has become active, but session has expired")}_updateUserActivity(e=Date.now()){this._lastActivity=e}_updateSessionActivity(e=Date.now()){if(this.session){this.session.lastActivity=e;this._maybeSaveSession()}}_createCustomBreadcrumb(e){this.addUpdate((()=>{this.throttledAddEvent({type:Qt.Custom,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e}})}))}_addPerformanceEntries(){let e=Os(this.performanceEntries).concat(this.replayPerformanceEntries);this.performanceEntries=[];this.replayPerformanceEntries=[];if(this._requiresManualStart){const t=this._context.initialTimestamp/1e3;e=e.filter((e=>e.start>=t))}return Promise.all(zr(this,e))}_clearContext(){this._context.errorIds.clear();this._context.traceIds.clear();this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){const{session:e,eventBuffer:t}=this;if(!e||!t||this._requiresManualStart)return;if(e.segmentId)return;const n=t.getEarliestTimestamp();n&&n<this._context.initialTimestamp&&(this._context.initialTimestamp=n)}_popEventContext(){const e={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};this._clearContext();return e}async _runFlush(){const e=this.getSessionId();if(this.session&&this.eventBuffer&&e){await this._addPerformanceEntries();if(this.eventBuffer?.hasEvents){await To(this);if(this.eventBuffer&&e===this.getSessionId())try{this._updateInitialTimestampFromEventBuffer();const t=Date.now();if(t-this._context.initialTimestamp>this._options.maxReplayDuration+3e4)throw new Error("Session is too long, not sending replay");const n=this._popEventContext();const s=this.session.segmentId++;this._maybeSaveSession();const r=await this.eventBuffer.finish();await Wo({replayId:e,recordingData:r,segmentId:s,eventContext:n,session:this.session,timestamp:t,onError:e=>this.handleException(e)})}catch(e){this.handleException(e);this.stop({reason:"sendReplay"});const t=u();if(t){const n=e instanceof RateLimitError?"ratelimit_backoff":"send_error";t.recordDroppedEvent(n,"replay")}}}}else $s&&Xs.error("No session or eventBuffer found to flush.")}async _flush({force:e=false}={}){if(!this._isEnabled&&!e)return;if(!this.checkAndHandleExpiredSession()){$s&&Xs.error("Attempting to finish replay event after session expired.");return}if(!this.session)return;const t=this.session.started;const n=Date.now();const s=n-t;this._debouncedFlush.cancel();const r=s<this._options.minReplayDuration;const o=s>this._options.maxReplayDuration+5e3;if(r||o){$s&&Xs.info(`Session duration (${Math.floor(s/1e3)}s) is too ${r?"short":"long"}, not sending replay.`);r&&this._debouncedFlush();return}const i=this.eventBuffer;i&&this.session.segmentId===0&&!i.hasCheckout&&$s&&Xs.info("Flushing initial segment without checkout.");const a=!!this._flushLock;this._flushLock||(this._flushLock=this._runFlush());try{await this._flushLock}catch(e){this.handleException(e)}finally{this._flushLock=void 0;a&&this._debouncedFlush()}}_maybeSaveSession(){this.session&&this._options.stickySession&&or(this.session)}_onMutationHandler(e){const t=e.length;const n=this._options.mutationLimit;const s=this._options.mutationBreadcrumbLimit;const r=n&&t>n;if(t>s||r){const e=gs({category:"replay.mutations",data:{count:t,limit:r}});this._createCustomBreadcrumb(e)}if(r){this.stop({reason:"mutationLimit",forceFlush:this.recordingMode==="session"});return false}return true}}function qo(e,t){return[...e,...t].join(",")}function Vo({mask:e,unmask:t,block:n,unblock:s,ignore:r}){const o=["base","iframe[srcdoc]:not([src])"];const i=qo(e,[".sentry-mask","[data-sentry-mask]"]);const a=qo(t,[]);const c={maskTextSelector:i,unmaskTextSelector:a,blockSelector:qo(n,[".sentry-block","[data-sentry-block]",...o]),unblockSelector:qo(s,[]),ignoreSelector:qo(r,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'])};return c}function Ko({el:e,key:t,maskAttributes:n,maskAllText:s,privacyOptions:r,value:o}){return s?r.unmaskTextSelector&&e.matches(r.unmaskTextSelector)?o:n.includes(t)||t==="value"&&e.tagName==="INPUT"&&["submit","button"].includes(e.getAttribute("type")||"")?o.replace(/[\S]/g,"*"):o:o}const Jo='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]';const Go=["content-length","content-type","accept"];let Yo=false;const Xo=e=>new Replay(e);class Replay{constructor({flushMinDelay:e=X,flushMaxDelay:t=Q,minReplayDuration:n=ae,maxReplayDuration:s=le,stickySession:r=true,useCompression:o=true,workerUrl:i,_experiments:a={},maskAllText:c=true,maskAllInputs:l=true,blockAllMedia:u=true,mutationBreadcrumbLimit:d=750,mutationLimit:h=1e4,slowClickTimeout:p=7e3,slowClickIgnoreSelectors:f=[],networkDetailAllowUrls:m=[],networkDetailDenyUrls:y=[],networkCaptureBodies:g=true,networkRequestHeaders:S=[],networkResponseHeaders:k=[],mask:v=[],maskAttributes:b=["title","placeholder"],unmask:w=[],block:_=[],unblock:I=[],ignore:C=[],maskFn:E,beforeAddRecordingEvent:M,beforeErrorSampling:x,onError:T}={}){this.name="Replay";const O=Vo({mask:v,unmask:w,block:_,unblock:I,ignore:C});this._recordingOptions={maskAllInputs:l,maskAllText:c,maskInputOptions:{password:true},maskTextFn:E,maskInputFn:E,maskAttributeFn:(e,t,n)=>Ko({maskAttributes:b,maskAllText:c,privacyOptions:O,key:e,value:t,el:n}),...O,slimDOMOptions:"all",inlineStylesheet:true,inlineImages:false,collectFonts:true,errorHandler:e=>{try{e.__rrweb__=true}catch(e){}},recordCrossOriginIframes:Boolean(a.recordCrossOriginIframes)};this._initialOptions={flushMinDelay:e,flushMaxDelay:t,minReplayDuration:Math.min(n,ce),maxReplayDuration:Math.min(s,le),stickySession:r,useCompression:o,workerUrl:i,blockAllMedia:u,maskAllInputs:l,maskAllText:c,mutationBreadcrumbLimit:d,mutationLimit:h,slowClickTimeout:p,slowClickIgnoreSelectors:f,networkDetailAllowUrls:m,networkDetailDenyUrls:y,networkCaptureBodies:g,networkRequestHeaders:Zo(S),networkResponseHeaders:Zo(k),beforeAddRecordingEvent:M,beforeErrorSampling:x,onError:T,_experiments:a};this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${Jo}`:Jo);if(this._isInitialized&&R())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=true}get _isInitialized(){return Yo}set _isInitialized(e){Yo=e}afterAllSetup(e){if(R()&&!this._replay){this._setup(e);this._initialize(e)}}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:this._replay.recordingMode==="session"}):Promise.resolve()}flush(e){if(!this._replay)return Promise.resolve();if(!this._replay.isEnabled()){this._replay.start();return Promise.resolve()}return this._replay.sendBufferedReplayOrFlush(e)}getReplayId(){if(this._replay?.isEnabled())return this._replay.getSessionId()}getRecordingMode(){if(this._replay?.isEnabled())return this._replay.recordingMode}_initialize(e){if(this._replay){this._maybeLoadFromReplayCanvasIntegration(e);this._replay.initializeSampling()}}_setup(e){const t=Qo(this._initialOptions,e);this._replay=new ReplayContainer({options:t,recordingOptions:this._recordingOptions})}_maybeLoadFromReplayCanvasIntegration(e){
/* eslint-disable @typescript-eslint/no-non-null-assertion */
try{const t=e.getIntegrationByName("ReplayCanvas");if(!t)return;this._replay._canvas=t.getOptions()}catch{}
/* eslint-enable @typescript-eslint/no-non-null-assertion */}}function Qo(e,t){const n=t.getOptions();const s={sessionSampleRate:0,errorSampleRate:0,...e};const r=O(n.replaysSessionSampleRate);const o=O(n.replaysOnErrorSampleRate);r==null&&o==null&&A((()=>{console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set.")}));r!=null&&(s.sessionSampleRate=r);o!=null&&(s.errorSampleRate=o);return s}function Zo(e){return[...Go,...e.map((e=>e.toLowerCase()))]}function ei(){const e=u();return e?.getIntegrationByName("Replay")}export{ei as getReplay,Xo as replayIntegration};

